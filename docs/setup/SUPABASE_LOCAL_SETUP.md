# Supabase ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¬ã‚¤ãƒ‰

BoxLogã®ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒã§Supabaseã‚’èµ·å‹•ã™ã‚‹æ–¹æ³•ã‚’èª¬æ˜ã—ã¾ã™ã€‚

**æ‰€è¦æ™‚é–“**: 15åˆ†ï¼ˆåˆå›ï¼‰/ 5åˆ†ï¼ˆ2å›ç›®ä»¥é™ï¼‰

---

## ğŸ¯ æ¦‚è¦

ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§Dockerã‚’ä½¿ã£ã¦Supabaseã‚’èµ·å‹•ã—ã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶šãªã—ã§DBé–‹ç™ºãŒã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

**ãƒ¡ãƒªãƒƒãƒˆ:**

- âœ… ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã§é–‹ç™ºå¯èƒ½
- âœ… æœ¬ç•ªç’°å¢ƒã«å½±éŸ¿ã‚’ä¸ãˆãªã„
- âœ… ä½•åº¦ã§ã‚‚ãƒªã‚»ãƒƒãƒˆãƒ»ã‚„ã‚Šç›´ã—ãŒã§ãã‚‹
- âœ… ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç®¡ç†ãŒè‡ªå‹•

---

## ğŸ“‹ å‰ææ¡ä»¶

### å¿…é ˆã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢

1. **Docker Desktop** ï¼ˆå¿…é ˆï¼‰
   - ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«: https://www.docker.com/products/docker-desktop/
   - macOS M1/M2/M3: ARM64ç‰ˆã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
   - ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¾Œã€Docker Desktopã‚’èµ·å‹•ã—ã¦ãŠã

2. **Supabase CLI**

   ```bash
   # Homebrewï¼ˆmacOSï¼‰
   brew install supabase/tap/supabase

   # ç¢ºèª
   supabase --version
   ```

---

## ğŸš€ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †

### Step 1: Docker Desktop ã®èµ·å‹•ç¢ºèª

```bash
# DockerãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ç¢ºèª
docker info

# âœ… æ­£å¸¸ã«è¡¨ç¤ºã•ã‚Œã‚Œã°OK
# âŒ ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹å ´åˆã¯ã€Docker Desktopã‚¢ãƒ—ãƒªã‚’èµ·å‹•
```

---

### Step 2: Supabase ã®åˆæœŸåŒ–ï¼ˆåˆå›ã®ã¿ï¼‰

```bash
# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§å®Ÿè¡Œ
cd /path/to/boxlog-app

# SupabaseåˆæœŸåŒ–ï¼ˆæ—¢ã«å®Ÿè¡Œæ¸ˆã¿ã®å ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—ï¼‰
supabase init
```

**ç”Ÿæˆã•ã‚Œã‚‹ãƒ•ã‚¡ã‚¤ãƒ«:**

- `supabase/config.toml` - Supabaseè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
- `supabase/migrations/` - ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«æ ¼ç´å ´æ‰€

---

### Step 3: Supabase ã®èµ·å‹•

```bash
# ãƒ­ãƒ¼ã‚«ãƒ«Supabaseã‚’èµ·å‹•ï¼ˆåˆå›ã¯5åˆ†ã€2å›ç›®ä»¥é™ã¯30ç§’ï¼‰
supabase start
```

**åˆå›èµ·å‹•æ™‚:**

- Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ï¼ˆ~1GBï¼‰
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ»èªè¨¼ãƒ»ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãªã©å…¨ã‚µãƒ¼ãƒ“ã‚¹èµ·å‹•
- å®Œäº†ã™ã‚‹ã¾ã§5åˆ†ã»ã©ã‹ã‹ã‚Šã¾ã™

**èµ·å‹•å®Œäº†ã™ã‚‹ã¨ã€ä»¥ä¸‹ã®æƒ…å ±ãŒè¡¨ç¤ºã•ã‚Œã¾ã™:**

```
         API URL: http://127.0.0.1:54321
     GraphQL URL: http://127.0.0.1:54321/graphql/v1
  S3 Storage URL: http://127.0.0.1:54321/storage/v1/s3
    Database URL: postgresql://postgres:postgres@127.0.0.1:54322/postgres
      Studio URL: http://127.0.0.1:54323
     Mailpit URL: http://127.0.0.1:54324
 Publishable key: <anon-key>
      Secret key: <service-role-key>
```

---

### Step 4: ç’°å¢ƒå¤‰æ•°ã®è¨­å®š

#### 4-1. `.env.local` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ

```bash
# .env.exampleã‚’ã‚³ãƒ”ãƒ¼
cp .env.example .env.local
```

#### 4-2. ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã®å€¤ã‚’è¨­å®š

`.env.local` ã‚’é–‹ã„ã¦ã€ä»¥ä¸‹ã®å€¤ã‚’è¨­å®šï¼š

```bash
# ========================
# ğŸ” Supabase Configurationï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒï¼‰
# ========================
NEXT_PUBLIC_SUPABASE_URL=http://127.0.0.1:54321
NEXT_PUBLIC_SUPABASE_ANON_KEY=<supabase start ã§è¡¨ç¤ºã•ã‚ŒãŸPublishable key>
SUPABASE_SERVICE_ROLE_KEY=<supabase start ã§è¡¨ç¤ºã•ã‚ŒãŸSecret key>
```

**é‡è¦:**

- ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã®ã‚­ãƒ¼ã¯å›ºå®šå€¤ãªã®ã§ã€ãƒãƒ¼ãƒ å†…ã§å…±æœ‰ã—ã¦OK
- æœ¬ç•ªç’°å¢ƒã®ã‚­ãƒ¼ã¯çµ¶å¯¾ã« `.env.local` ã«ã‚³ãƒŸãƒƒãƒˆã—ãªã„

---

### Step 5: å‹•ä½œç¢ºèª

#### 5-1. Supabase Studio ã‚’é–‹ã

ãƒ–ãƒ©ã‚¦ã‚¶ã§ http://127.0.0.1:54323 ã«ã‚¢ã‚¯ã‚»ã‚¹

**ç¢ºèªé …ç›®:**

- âœ… Supabase Studio ã®ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- âœ… ã€ŒTable Editorã€ã§ `tags` ãƒ†ãƒ¼ãƒ–ãƒ«ãŒç¢ºèªã§ãã‚‹

#### 5-2. Next.js ã‚¢ãƒ—ãƒªã‚’èµ·å‹•

```bash
npm run dev
```

ãƒ–ãƒ©ã‚¦ã‚¶ã§ http://localhost:3000 ã«ã‚¢ã‚¯ã‚»ã‚¹

**æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œ:**

- âœ… ã‚¨ãƒ©ãƒ¼ãªãã‚¢ãƒ—ãƒªãŒèµ·å‹•
- âœ… Supabaseæ¥ç¶šã‚¨ãƒ©ãƒ¼ãŒå‡ºãªã„

---

## ğŸ› ï¸ ã‚ˆãä½¿ã†ã‚³ãƒãƒ³ãƒ‰

### èµ·å‹•ãƒ»åœæ­¢

```bash
# Supabaseã‚’èµ·å‹•
supabase start

# Supabaseã‚’åœæ­¢
supabase stop

# Supabaseã‚’å†èµ·å‹•
supabase restart

# Supabaseã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç¢ºèª
supabase status
```

---

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ“ä½œ

```bash
# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ãƒªã‚»ãƒƒãƒˆï¼ˆå…¨ãƒ‡ãƒ¼ã‚¿å‰Šé™¤ + ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å†é©ç”¨ï¼‰
supabase db reset

# ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ–°è¦ä½œæˆ
supabase migration new <migration_name>

# ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å±¥æ­´ã‚’ç¢ºèª
supabase migration list

# Supabase Studio ã‚’é–‹ã
open http://127.0.0.1:54323
```

---

### ãƒ­ã‚°ç¢ºèª

```bash
# å…¨ã‚µãƒ¼ãƒ“ã‚¹ã®ãƒ­ã‚°ã‚’è¡¨ç¤º
supabase logs

# ç‰¹å®šã‚µãƒ¼ãƒ“ã‚¹ã®ãƒ­ã‚°ã®ã¿è¡¨ç¤º
supabase logs db        # PostgreSQL
supabase logs auth      # Supabase Auth
supabase logs storage   # Storage
```

---

## ğŸš¨ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚¨ãƒ©ãƒ¼: `Docker is not running`

**åŸå› **: Docker Desktop ãŒèµ·å‹•ã—ã¦ã„ãªã„

**è§£æ±ºç­–**:

1. Docker Desktop ã‚¢ãƒ—ãƒªã‚’èµ·å‹•
2. ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒãƒ¼ã« Docker ã‚¢ã‚¤ã‚³ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
3. `docker info` ã§ç¢ºèª

---

### ã‚¨ãƒ©ãƒ¼: `Port 54321 is already in use`

**åŸå› **: æ—¢ã«SupabaseãŒèµ·å‹•ä¸­ã€ã¾ãŸã¯åˆ¥ã®ã‚¢ãƒ—ãƒªãŒãƒãƒ¼ãƒˆã‚’ä½¿ç”¨

**è§£æ±ºç­–**:

```bash
# æ—¢å­˜ã®Supabaseã‚’åœæ­¢
supabase stop

# ãã‚Œã§ã‚‚ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹å ´åˆã€ãƒãƒ¼ãƒˆä½¿ç”¨çŠ¶æ³ã‚’ç¢ºèª
lsof -i :54321

# è©²å½“ãƒ—ãƒ­ã‚»ã‚¹ã‚’åœæ­¢ã—ã¦ã‹ã‚‰å†èµ·å‹•
supabase start
```

---

### ã‚¨ãƒ©ãƒ¼: `Applying migration ... failed`

**åŸå› **: ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã«SQLã‚¨ãƒ©ãƒ¼ãŒã‚ã‚‹

**è§£æ±ºç­–**:

```bash
# ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç¢ºèª
supabase start --debug

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¦ã‚„ã‚Šç›´ã—
supabase db reset
```

---

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãŒç©ºã£ã½

**åŸå› **: ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãŒé©ç”¨ã•ã‚Œã¦ã„ãªã„

**è§£æ±ºç­–**:

```bash
# ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å†é©ç”¨
supabase db reset

# ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å±¥æ­´ã‚’ç¢ºèª
supabase migration list
```

---

## ğŸ”— æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒãŒå‹•ä½œã—ãŸã‚‰ã€æ¬¡ã¯æœ¬ç•ªç’°å¢ƒã®æ§‹ç¯‰ã«é€²ã¿ã¾ã—ã‚‡ã†ï¼š

1. **Staging/Productionç’°å¢ƒã®æ§‹ç¯‰**
   - `docs/setup/SUPABASE_ENV_SETUP.md` ï¼ˆä½œæˆäºˆå®šï¼‰
   - Supabase Dashboardã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ
   - Vercelç’°å¢ƒå¤‰æ•°è¨­å®š

2. **ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç®¡ç†**
   - `docs/development/DB_MIGRATION.md` ï¼ˆä½œæˆäºˆå®šï¼‰
   - é–‹ç™ºâ†’ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°â†’æœ¬ç•ªã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ•ãƒ­ãƒ¼

3. **Issue #601 ã® Phase 2 ã¸é€²ã‚€**
   - https://github.com/t3-nico/boxlog-app/issues/601

---

## ğŸ“š å‚è€ƒãƒªãƒ³ã‚¯

- [Supabase Local Development](https://supabase.com/docs/guides/cli/local-development)
- [Supabase CLI Reference](https://supabase.com/docs/reference/cli/introduction)
- [Docker Desktop](https://www.docker.com/products/docker-desktop/)

---

**ğŸ“– æœ€çµ‚æ›´æ–°**: 2025-10-24 | **ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: v1.0 - åˆç‰ˆ

---

**ç¨®é¡**: ğŸ“— ãƒã‚¦ãƒ„ãƒ¼ã‚¬ã‚¤ãƒ‰
**æœ€çµ‚æ›´æ–°**: 2025-12-11
**æ‰€æœ‰è€…**: BoxLog é–‹ç™ºãƒãƒ¼ãƒ 
