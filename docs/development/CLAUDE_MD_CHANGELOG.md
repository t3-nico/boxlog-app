# CLAUDE.md 変更履歴

このドキュメントは `/CLAUDE.md` の変更履歴を記録します。

---

## v12.0（2026-01-21）- 楽観的更新ガイドライン追加

**変更内容**:

- ✅ 「🔄 楽観的更新（Optimistic Updates）」セクション追加
  - 基本方針: 全mutationで楽観的更新を実装
  - 実装パターン（テンプレート）コード例
  - 楽観的更新が不要なケースの定義
  - 新規mutation作成時のチェックリスト

**理由**:

- GAFA基準評価でキャッシュ一貫性とRealtime競合対策の改善が必要と判明
- 楽観的更新を標準開発パターンとして確立
- 体感速度200-800ms改善を全機能で実現

**関連実装**:

- Tags: getByIdキャッシュ同期、isMutatingフラグ追加
- useTagCacheStore作成（Realtime競合防止）
- useTagRealtime更新（mutation中はスキップ）

---

## v11.6〜v11.9

> **注記**: これらのバージョンの詳細な変更履歴は記録されていません。
> 主な変更: カスタムコマンド・スキルの追加、依存関係運用ルールの整備など。

---

## v11.5（2025-12-25）- GAFA-First原則の追加

**変更内容**:

- ✅ 「意思決定の優先順位」を3層構造に再編
  - **レベル1**: UIパターン・インタラクション（Material Design, Apple HIG）
  - **レベル2**: 技術選定・アーキテクチャ（GAFA製OSS、推奨パターン）
  - **レベル3**: 設計思想・原則（テックブログ、公開ドキュメント）
- ✅ 競合時のルールを明確化
  - 「競合時は開発者に確認」
- ✅ Google製品参照を文脈依存に変更
  - 固定（Google Calendar）→ 文脈に合うGoogle製品

**理由**:

- GAFA製のライブラリ・ツールに乗ることで、設計判断コストを削減
- 「巨人の肩に乗る」戦略の明文化
- 競合時の判断を開発者に委ねることで柔軟性を確保

**効果**: 設計判断の迷いを減らし、プロダクト固有の価値に集中できる

---

## v11.3（2025-12-24）- 公式ベストプラクティス準拠の簡素化

**変更内容**:

- ✅ CLAUDE.mdを531行から約250行に簡素化
  - Anthropic公式推奨（< 300行）に準拠
  - 変更履歴を `docs/development/CLAUDE_MD_CHANGELOG.md` に分離
  - 詳細な説明は下位ドキュメントへ参照
- ✅ `.claude/commands/` を作成
  - `/review` - コードレビュー
  - `/fix-types` - 型エラー修正
  - `/new-feature` - 新機能実装
  - `/test` - テスト作成
  - `/debug` - デバッグ
- ✅ #キー活用ガイドを追加

**理由**:

- Anthropic公式ドキュメントで「CLAUDE.mdは簡潔に（< 300行）」が推奨
- 長いドキュメントはコンテキストを消費し、重要情報が埋もれる

**効果**: コンテキスト効率の向上、重要ルールの視認性向上

---

## v11.2（2025-12-24）- Claude 4ベストプラクティス統合

**変更内容**:

- ✅ Claude 4プロンプトエンジニアリングベストプラクティスを追加
  - 新規作成: `docs/development/CLAUDE_4_BEST_PRACTICES.md`
  - 公式ドキュメントへの参照を「レベル1：公式ドキュメント」に追加
- ✅ AIの行動規範に「ベストプラクティスに基づく行動規範」セクション追加
  - 曖昧な指示への対応テンプレート
  - ベストプラクティス違反の検出と報告
  - 開発者への質問を促すケース
- ✅ 開発ワークフローセクションにドキュメント参照を追加

**理由**:

- Claude 4モデルは「指示を文字通りに実行する」特性があり、明確な指示が必要
- 開発者とAIの双方向コミュニケーション改善
- ベストプラクティスに沿わない場合の自動検出と提案

**効果**: 開発者とClaude Code間のコミュニケーション品質向上

---

## v11.1（2025-11-12）- リリース管理の必須化

**変更内容**:

- ✅ 絶対遵守ルールに「リリース作業」を追加（ルール9）
  - リリース作業前に `docs/releases/RELEASE_CHECKLIST.md` を必ず参照
  - 既存バージョンの重複チェックを最優先化
  - package.json 更新タイミングの明確化（PRマージ前）
- ✅ 詳細ドキュメント参照先に「リリース管理」セクション追加
  - RELEASE_CHECKLIST.md を最優先ドキュメントとして位置付け
  - AIの行動規範を明確化（重複時は必ず確認）

**理由**:

- v0.4.0 リリース時の重大ミス（v0.3.0重複）を防止
- AIがリリースドキュメントを参照する明確なトリガーが必要

**効果**: AIによるリリース作業の確実性向上

---

## v11.0（2025-10-30）- 開発サーバー管理の抜本的見直し

**変更内容**:

- ✅ 開発サーバー管理をユーザー責務に変更
  - AIは開発サーバーを起動・停止しない
  - AIは `npm run typecheck` でエラーチェックのみ実施
- ✅ ポート番号ルール（PORT=4000等）を完全削除
- ✅ 開発ワークフローの簡素化
  - AI責務: `npm run typecheck`, `npm run lint`（コミット前のみ）
  - ユーザー責務: `npm run dev`（開発サーバー）

**理由**:

- 複数サーバー起動によるリソース無駄・ポート競合を防止
- ユーザーの確認環境（localhost:3000）と一致
- 役割分担の明確化

**効果**: シンプルで混乱のない開発フロー

---

## v10.1（2025-10-22）- Phase 1 + Phase 3 完了

**Phase 1（緊急修正）**:

- ✅ リンク切れ修正
- ✅ export default ルール修正（App Router の例外を明記）
- ✅ 絵文字使用方針の統一

**Phase 3（構造改善）**:

- ✅ Single Source of Truth の徹底
  - 新規作成: `docs/design-system/STYLE_GUIDE.md`
- ✅ 頻出パターン集の追加

**効果**: ドキュメント評価 65点 → 85点

---

## v10.0（2025-10-21）

- AIによる test:watch 自動起動を必須化

---

## v9.3 以前

- Issue管理の柔軟な運用を明記
- コミット規約・Issue管理ルールの整備

---

**📖 最終更新**: 2026-01-21
