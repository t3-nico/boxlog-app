# CLAUDE.md 変更履歴

このドキュメントは `/CLAUDE.md` の変更履歴を記録します。

---

## v14.0（2026-01-30）- 品質スコア95点達成: 包括的ガイドライン追加

**変更内容**:

- ✅ 「⚡ クイックスタート」セクション追加（毎セッション確認用）
- ✅ 「セキュリティ」セクション追加（XSS、SQLインジェクション、認証バイパス対策）
- ✅ 「ファイル命名規則」追加（コンポーネント、フック、ユーティリティ等）
- ✅ 「import順序」追加（React→外部→内部→相対→型）
- ✅ 「Server Component vs Client Component」判定フロー追加
- ✅ 「テスト実装パターン」追加（Arrange-Act-Assert、tRPCテスト）
- ✅ 「アクセシビリティ必須ルール」追加（aria-label、alt、タッチターゲット）
- ✅ 「React最適化パターン」追加（useMemo、useCallback、React.memo）
- ✅ 「エラー境界」ガイドライン追加

**理由**:

- 82点→95点への品質向上を目指し、不足していた領域を網羅
- 新規セッション開始時の立ち上がり時間を短縮
- セキュリティ・アクセシビリティの明文化でプロダクト品質を担保

---

## v13.2（2026-01-30）- AI指示最適化: 拡張思考・判断フロー・コード例追加

**変更内容**:

- ✅ 「🤔 拡張思考（Extended Thinking）」セクション追加
  - think/think hard/think harder/ultrathink の4レベル使い分け基準
  - 判定フローチャート
  - 使用例
- ✅ 「曖昧な指示への対応」強化
  - 判断フローチャート追加
  - 質問テンプレート追加
- ✅ 「CLAUDE.md vs ユーザー指示の競合」セクション追加
  - 競合時の対応方針と対話テンプレート
- ✅ 「tRPCエラーハンドリングパターン」追加
  - TRPCErrorの適切な使用例
  - エラーコード使い分け表
- ✅ 「Zustand実装パターン」追加
  - 型安全なストア設計例
  - セレクタによる再レンダリング最適化
- ✅ ワークフローにthinkツール統合

**理由**:

- `CLAUDE_4_BEST_PRACTICES.md`の原則を実践的に統合
- AIが自律的に判断レベルを選択できるよう基準を明確化
- コード例により実装パターンの理解を促進

---

## v13.1（2026-01-29）- ベストプラクティス適合: ルールに理由を追加

**変更内容**:

- ✅ 「🚫 絶対的禁止事項」の各ルールに「**理由**」を追加
  - 型定義: `any`禁止の理由（型安全性、IDE補完）
  - スタイリング: セマンティックトークンの理由（ダークモード、一括修正）
  - コンポーネント: named exportの理由（tree-shaking、リファクタリング）
  - データフェッチング: tRPC推奨の理由（E2E型安全、race condition防止）
  - ログ出力: logger推奨の理由（ログレベル制御、Sentry連携）
  - 状態管理: Zustand推奨の理由（最小ボイラープレート）

**理由**:

- `CLAUDE_4_BEST_PRACTICES.md`の「背景と動機を説明する」原則に適合
- AIが「なぜ」を理解することで、類似ケースでも正しい判断が可能に

---

## v13.0（2026-01-29）- tRPCエンドポイント・機能一覧の更新

**変更内容**:

- ✅ tRPCエンドポイント一覧を最新化
  - Plans router追加（12エンドポイント: crud, activities, bulk, instances, recurrence, statistics, tags, transaction）
  - Records router追加（2エンドポイント: crud, tags）
  - Notifications, Profile, Auth, UserSettings, NotificationPreferences追加
- ✅ 「🏗️ 主要機能（Features）」セクション追加
  - Plans, Records, Calendar, Tags, Stats, Inspector, Auth, Settings, Navigation, Search
- ✅ 「🧪 CI/CDパイプライン」セクション追加
  - Lighthouse CI閾値（Performance 80, Accessibility 90, Best Practices 85）
  - テストカバレッジコマンド
  - PostHogアナリティクス設定
- ✅ ログ出力ルール追加
  - `console.log/info/debug` 禁止、`@/lib/logger`使用推奨
- ✅ Tech Stackに CI/品質、アナリティクス項目追加

**理由**:

- v0.13.0リリースでの大幅な機能追加・リファクタリングを反映
- inbox→plans リネーム、Records機能強化に対応
- CI/CD品質ゲート（Lighthouse CI）の導入を明文化

**関連PR**:

- #926: Record機能とInspector UIの大幅改善
- #922: inbox→plan リネーム & inspector改善
- #916: タグ機能の改善とリファクタリング

---

## v12.0（2026-01-21）- 楽観的更新ガイドライン追加

**変更内容**:

- ✅ 「🔄 楽観的更新（Optimistic Updates）」セクション追加
  - 基本方針: 全mutationで楽観的更新を実装
  - 実装パターン（テンプレート）コード例
  - 楽観的更新が不要なケースの定義
  - 新規mutation作成時のチェックリスト

**理由**:

- GAFA基準評価でキャッシュ一貫性とRealtime競合対策の改善が必要と判明
- 楽観的更新を標準開発パターンとして確立
- 体感速度200-800ms改善を全機能で実現

**関連実装**:

- Tags: getByIdキャッシュ同期、isMutatingフラグ追加
- useTagCacheStore作成（Realtime競合防止）
- useTagRealtime更新（mutation中はスキップ）

---

## v11.6〜v11.9

> **注記**: これらのバージョンの詳細な変更履歴は記録されていません。
> 主な変更: カスタムコマンド・スキルの追加、依存関係運用ルールの整備など。

---

## v11.5（2025-12-25）- GAFA-First原則の追加

**変更内容**:

- ✅ 「意思決定の優先順位」を3層構造に再編
  - **レベル1**: UIパターン・インタラクション（Material Design, Apple HIG）
  - **レベル2**: 技術選定・アーキテクチャ（GAFA製OSS、推奨パターン）
  - **レベル3**: 設計思想・原則（テックブログ、公開ドキュメント）
- ✅ 競合時のルールを明確化
  - 「競合時は開発者に確認」
- ✅ Google製品参照を文脈依存に変更
  - 固定（Google Calendar）→ 文脈に合うGoogle製品

**理由**:

- GAFA製のライブラリ・ツールに乗ることで、設計判断コストを削減
- 「巨人の肩に乗る」戦略の明文化
- 競合時の判断を開発者に委ねることで柔軟性を確保

**効果**: 設計判断の迷いを減らし、プロダクト固有の価値に集中できる

---

## v11.3（2025-12-24）- 公式ベストプラクティス準拠の簡素化

**変更内容**:

- ✅ CLAUDE.mdを531行から約250行に簡素化
  - Anthropic公式推奨（< 300行）に準拠
  - 変更履歴を `docs/development/CLAUDE_MD_CHANGELOG.md` に分離
  - 詳細な説明は下位ドキュメントへ参照
- ✅ `.claude/commands/` を作成
  - `/review` - コードレビュー
  - `/fix-types` - 型エラー修正
  - `/new-feature` - 新機能実装
  - `/test` - テスト作成
  - `/debug` - デバッグ
- ✅ #キー活用ガイドを追加

**理由**:

- Anthropic公式ドキュメントで「CLAUDE.mdは簡潔に（< 300行）」が推奨
- 長いドキュメントはコンテキストを消費し、重要情報が埋もれる

**効果**: コンテキスト効率の向上、重要ルールの視認性向上

---

## v11.2（2025-12-24）- Claude 4ベストプラクティス統合

**変更内容**:

- ✅ Claude 4プロンプトエンジニアリングベストプラクティスを追加
  - 新規作成: `docs/development/CLAUDE_4_BEST_PRACTICES.md`
  - 公式ドキュメントへの参照を「レベル1：公式ドキュメント」に追加
- ✅ AIの行動規範に「ベストプラクティスに基づく行動規範」セクション追加
  - 曖昧な指示への対応テンプレート
  - ベストプラクティス違反の検出と報告
  - 開発者への質問を促すケース
- ✅ 開発ワークフローセクションにドキュメント参照を追加

**理由**:

- Claude 4モデルは「指示を文字通りに実行する」特性があり、明確な指示が必要
- 開発者とAIの双方向コミュニケーション改善
- ベストプラクティスに沿わない場合の自動検出と提案

**効果**: 開発者とClaude Code間のコミュニケーション品質向上

---

## v11.1（2025-11-12）- リリース管理の必須化

**変更内容**:

- ✅ 絶対遵守ルールに「リリース作業」を追加（ルール9）
  - リリース作業前に `docs/releases/RELEASE_CHECKLIST.md` を必ず参照
  - 既存バージョンの重複チェックを最優先化
  - package.json 更新タイミングの明確化（PRマージ前）
- ✅ 詳細ドキュメント参照先に「リリース管理」セクション追加
  - RELEASE_CHECKLIST.md を最優先ドキュメントとして位置付け
  - AIの行動規範を明確化（重複時は必ず確認）

**理由**:

- v0.4.0 リリース時の重大ミス（v0.3.0重複）を防止
- AIがリリースドキュメントを参照する明確なトリガーが必要

**効果**: AIによるリリース作業の確実性向上

---

## v11.0（2025-10-30）- 開発サーバー管理の抜本的見直し

**変更内容**:

- ✅ 開発サーバー管理をユーザー責務に変更
  - AIは開発サーバーを起動・停止しない
  - AIは `npm run typecheck` でエラーチェックのみ実施
- ✅ ポート番号ルール（PORT=4000等）を完全削除
- ✅ 開発ワークフローの簡素化
  - AI責務: `npm run typecheck`, `npm run lint`（コミット前のみ）
  - ユーザー責務: `npm run dev`（開発サーバー）

**理由**:

- 複数サーバー起動によるリソース無駄・ポート競合を防止
- ユーザーの確認環境（localhost:3000）と一致
- 役割分担の明確化

**効果**: シンプルで混乱のない開発フロー

---

## v10.1（2025-10-22）- Phase 1 + Phase 3 完了

**Phase 1（緊急修正）**:

- ✅ リンク切れ修正
- ✅ export default ルール修正（App Router の例外を明記）
- ✅ 絵文字使用方針の統一

**Phase 3（構造改善）**:

- ✅ Single Source of Truth の徹底
  - 新規作成: `docs/design-system/STYLE_GUIDE.md`
- ✅ 頻出パターン集の追加

**効果**: ドキュメント評価 65点 → 85点

---

## v10.0（2025-10-21）

- AIによる test:watch 自動起動を必須化

---

## v9.3 以前

- Issue管理の柔軟な運用を明記
- コミット規約・Issue管理ルールの整備

---

**📖 最終更新**: 2026-01-29
