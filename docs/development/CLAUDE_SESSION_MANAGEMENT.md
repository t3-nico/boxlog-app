# Claude Code セッション管理ガイド

BoxLog開発における効率的なClaude Codeセッション管理の完全ガイドです。

## 🎯 概要

このガイドは、Claude Codeを使用したBoxLog開発において、最大限の効率性とコードの品質を実現するためのセッション管理戦略を定義します。

## 📋 基本原則

### セッション境界の明確化

#### 1. 機能単位セッション

- **1つのfeature/fix/\*ブランチ = 1セッション**
- ブランチ作成から完了まで一貫した文脈を維持
- 複雑な機能は複数セッションに分割（工程別）

#### 2. 時間制限セッション

- **最大2時間**または集中力低下時点で区切り
- 長時間作業による品質低下を防止
- 定期的な休憩でパフォーマンス維持

#### 3. Issue単位セッション

- **1つのGitHub Issue = 1〜複数セッション**
- 工程の複雑さに応じて分割
- Issue完了まで追跡可能な記録を維持

## 🔄 セッション遷移戦略

### 必須コマンド実行

#### タスク切り替え時

```bash
# 必須: 新しいタスクを開始する前
/clear

# セッション開始記録例
echo "=== セッション開始 ==="
echo "Issue: #123 - ユーザー認証機能の実装"
echo "目標: ログイン画面のUI実装とバリデーション"
echo "予定時間: 1.5時間"
```

#### 工程切り替え時

```bash
# 探索→設計の切り替え
/clear
echo "工程変更: 技術調査完了 → UI設計開始"

# 設計→実装の切り替え
/clear
echo "工程変更: 設計完了 → コーディング開始"

# 実装→検証の切り替え
/clear
echo "工程変更: 実装完了 → テスト・品質チェック開始"
```

#### 緊急対応時

```bash
# 現在のセッションを一時中断
echo "緊急対応のため現セッション中断"
echo "中断時点: [具体的な作業内容]"
echo "再開時の注意点: [継続に必要な情報]"

/clear
echo "緊急対応セッション開始"
```

## 📊 コンテキスト管理

### 使用率監視

#### 60%到達時のアラート

- コンテキストの整理を検討
- 不要な情報の削除
- `/compact`コマンドの実行検討

#### 80%到達時の必須対応

```bash
# 必須実行
/compact

# または新セッション開始
/clear
echo "コンテキスト制限によりセッション分割"
echo "前セッション成果: [完了内容を記録]"
```

### 情報の優先順位付け

1. **最高**: 現在のタスクに直接関連
2. **高**: 設計・アーキテクチャ決定
3. **中**: エラー・警告の対処
4. **低**: 一般的な情報・参考資料

## 🏗️ 開発工程別セッション詳細

### 1. 🔍 調査セッション

#### 目的

- Issue・要件の深堀り理解
- 技術的実現可能性の検証
- 既存コードベースの調査

#### 典型的な作業

```bash
# セッション開始
echo "=== 調査セッション開始 ==="
echo "対象: Issue #XXX の技術調査"

# 作業例
- コードベース検索・理解
- 関連ライブラリの調査
- API仕様の確認
- 既存実装パターンの分析
```

#### 成果物

- 技術的実現方法の明確化
- 必要なライブラリ・ツールの特定
- 実装時間の見積もり
- 設計方針の基本案

### 2. 📋 設計セッション

#### 目的

- アーキテクチャの詳細設計
- API・データ構造の定義
- UI/UXの設計

#### 典型的な作業

```bash
echo "=== 設計セッション開始 ==="
echo "対象: Issue #XXX の設計・アーキテクチャ"

# 作業例
- コンポーネント設計
- データフロー設計
- API設計・型定義
- エラーハンドリング設計
```

#### 成果物

- 詳細設計ドキュメント
- TypeScript型定義
- コンポーネント構造図
- API仕様書

### 3. ⚡ 実装セッション

#### 目的

- コーディング作業
- テスト実装
- 基本的な動作確認

#### 典型的な作業

```bash
echo "=== 実装セッション開始 ==="
echo "対象: Issue #XXX の実装"

# 作業例
- コンポーネント実装
- API実装
- テストコード作成
- 基本的な動作テスト
```

#### 成果物

- 実装済みコード
- テストスイート
- 基本的な動作確認結果
- 実装時の課題・発見事項

### 4. 🧪 検証セッション

#### 目的

- 包括的な品質チェック
- パフォーマンステスト
- ドキュメント更新

#### 典型的な作業

```bash
echo "=== 検証セッション開始 ==="
echo "対象: Issue #XXX の品質チェック・完了確認"

# 作業例
- ESLint・TypeScriptエラー修正
- アクセシビリティチェック
- パフォーマンス測定
- ドキュメント更新
```

#### 成果物

- 品質チェック完了確認
- パフォーマンステスト結果
- 更新されたドキュメント
- 本番デプロイ準備完了

## 📝 情報管理・記録戦略

### セッション開始時のテンプレート

```bash
echo "================================"
echo "🎯 セッション開始"
echo "================================"
echo "📅 日時: $(date)"
echo "🏷️  Issue: #XXX - [Issue タイトル]"
echo "🎯 目標: [このセッションの具体的目標]"
echo "⏱️  予定時間: [時間]"
echo "📋 工程: [調査/設計/実装/検証]"
echo "🔗 関連: [関連Issue・PR番号]"
echo "================================"
```

### セッション終了時のテンプレート

```bash
echo "================================"
echo "✅ セッション完了"
echo "================================"
echo "📅 終了時刻: $(date)"
echo "⏱️  実際時間: [実際にかかった時間]"
echo "🎯 達成度: [目標達成率 %]"
echo ""
echo "📊 成果:"
echo "- [具体的な成果1]"
echo "- [具体的な成果2]"
echo "- [具体的な成果3]"
echo ""
echo "⚠️  残課題:"
echo "- [残った課題1]"
echo "- [残った課題2]"
echo ""
echo "➡️  次アクション:"
echo "- [次にやるべきこと1]"
echo "- [次にやるべきこと2]"
echo ""
echo "🔍 発見・学び:"
echo "- [重要な発見や学び]"
echo ""
echo "🚨 問題・ブロッカー:"
echo "- [発見した問題] → Issue #XXX として起票"
echo "================================"
```

## 📊 品質指標・KPI

### 効率性指標

#### セッション目標達成率

- **目標**: 80%以上
- **測定**: 目標達成タスク数 / 設定目標タスク数
- **改善**: 目標設定の適正化、作業見積もりの精度向上

#### 時間予測精度

- **目標**: ±30%以内
- **測定**: |実際時間 - 予定時間| / 予定時間
- **改善**: 過去データの活用、タスク分割の最適化

#### `/clear`適切使用率

- **目標**: タスク切り替え時100%
- **測定**: 適切な/clear実行回数 / 必要な/clear回数
- **改善**: セッション管理意識の向上

### ナレッジ蓄積指標

#### CLAUDE.md更新頻度

- **目標**: セッション終了時100%
- **測定**: 記録済みセッション数 / 実施セッション数
- **改善**: 記録テンプレートの活用、習慣化

#### 決定事項記録率

- **目標**: 重要判断100%
- **測定**: 記録済み重要決定数 / 実際の重要決定数
- **改善**: 重要度判断基準の明確化

#### Issue起票率

- **目標**: 問題発見時100%
- **測定**: 起票されたIssue数 / 発見された問題数
- **改善**: 問題発見の感度向上、起票習慣化

## 🔧 ツール・コマンド活用

### Claude Codeコマンド

```bash
# セッション管理の基本コマンド
/clear        # 新セッション開始
/compact      # コンテキスト圧縮
/help         # ヘルプ表示

# 情報整理コマンド
/search       # コードベース検索
/explain      # コード説明
/review       # コードレビュー
```

### Git連携

```bash
# セッション開始時のブランチ確認
git status
git log --oneline -5

# セッション終了時のコミット
git add .
git commit -m "feat: implement XXX feature

セッション成果:
- [具体的な実装内容]
- [テスト追加内容]
- [ドキュメント更新内容]

Issue: #XXX
Session: [セッション種別] - [日時]"
```

## 🚨 トラブルシューティング

### よくある問題と対処法

#### コンテキストオーバーフロー

```bash
# 対処法1: 重要情報の再整理
echo "現在のコンテキスト: 重要情報のみ再構築"
/compact

# 対処法2: セッション分割
echo "セッション分割: 現在の成果を記録して新セッション開始"
/clear
```

#### セッション目標の不明確化

```bash
# 対処法: 目標の再定義
echo "目標再設定:"
echo "1. [具体的で測定可能な目標1]"
echo "2. [具体的で測定可能な目標2]"
echo "3. [具体的で測定可能な目標3]"
```

#### 長時間セッションによる効率低下

```bash
# 対処法: 強制的な区切り
echo "⚠️ 2時間経過アラート"
echo "現在の成果を記録して休憩またはセッション終了を推奨"
/clear
```

## 📚 参考資料・関連ドキュメント

### 基本ドキュメント

- [CLAUDE.md](../../CLAUDE.md) - メイン開発指針
- [Issue管理ルール](../../CLAUDE.md#issue管理ルール) - Issue運用方針
- [ESLint設定](../ESLINT_SETUP_COMPLETE.md) - コード品質管理
- [1Password設定](../1PASSWORD_SETUP.md) - セキュリティ管理

### セッション管理テンプレート

- [セッション開始テンプレート](./session-templates/SESSION_START_TEMPLATE.md) - 工程別開始テンプレート
- [セッション終了テンプレート](./session-templates/SESSION_END_TEMPLATE.md) - 工程別終了テンプレート
- [品質チェックリスト](./session-templates/QUALITY_CHECKLIST.md) - KPI・品質管理

---

**📖 このドキュメントについて**

- **作成日**: 2025-09-25
- **最終更新**: 2025-09-25
- **バージョン**: v1.0
- **関連Issue**: #257 - セッション戦略とコンテキスト管理ルールの確立詳細
