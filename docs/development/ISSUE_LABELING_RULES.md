# Issue ラベル付けルール

## 🎯 目的

Issue作成時に適切なラベルを自動的に付与し、一貫性のあるIssue管理を実現する。

### 💡 柔軟な運用方針

**何でも気軽にIssue化してOK！**

- ✅ 技術的な議論・アイデア・メモ
- ✅ 調査タスク・検証作業
- ✅ 気になったことや改善案
- ✅ 質問・相談事項

**削除は開発者が行うので、Claude Codeは積極的にIssue化してください。**

## 📋 ラベル体系

### 1. 種別ラベル（Type）- **必須・排他的**

Issueの作業種別を表すラベル。**1つのみ選択**。

| ラベル     | 説明                         | 自動判定キーワード                       |
| ---------- | ---------------------------- | ---------------------------------------- |
| `feature`  | 新機能の開発                 | `新機能`, `機能追加`, `追加`, `実装`     |
| `bug`      | バグ修正                     | `バグ`, `修正`, `不具合`, `エラー`       |
| `refactor` | リファクタリング・コード改善 | `リファクタ`, `改善`, `最適化`, `整理`   |
| `docs`     | ドキュメント作成・更新       | `ドキュメント`, `README`, `説明`, `更新` |
| `test`     | テスト関連                   | `テスト`, `spec`, `検証`                 |

**判定ロジック**:

1. タイトル・本文からキーワードを検出して自動判定
2. 該当するキーワードがない場合、**デフォルト: `feature`**

---

### 2. 優先度ラベル（Priority）- **必須・排他的**

作業の優先順位を表すラベル。**1つのみ選択**。

| ラベル      | 説明                        | 対応目安       | 自動判定キーワード                        |
| ----------- | --------------------------- | -------------- | ----------------------------------------- |
| `P0-urgent` | 緊急対応 - 即座に対応が必要 | 即座           | `urgent`, `critical`, `emergency`, `緊急` |
| `P1-high`   | 高優先度                    | 1-2日以内      | `high priority`, `重要`, `early`          |
| `P2-medium` | 中優先度                    | 1週間以内      | `medium`, `normal`, `通常`                |
| `P3-low`    | 低優先度                    | 時間のある時に | `low priority`, `nice to have`, `後回し`  |

**判定ロジック**:

1. タイトル・本文から緊急性キーワードを検出
2. 明示されていない場合、**デフォルト: `P3-low`**
3. ユーザーが優先度を明示的に指定した場合はそれを優先

**特殊ケース**:

- `bug` かつ本番環境に影響がある場合 → 自動的に `P1-high` 以上を推奨

---

### 3. サイズ見積もり（Size/Effort）- **必須・排他的**

作業時間の見積もりを表すラベル。**1つのみ選択**。

| ラベル    | 作業時間 | 目安                           |
| --------- | -------- | ------------------------------ |
| `size-XS` | ~1時間   | 軽微な修正、タイポ修正         |
| `size-S`  | ~4時間   | 小規模な機能追加、バグ修正     |
| `size-M`  | ~1日     | 中規模な機能、複数ファイル変更 |
| `size-L`  | ~3日     | 大規模な機能、設計が必要       |

**判定ロジック**:

1. タイトル・本文から作業量のキーワードを検出
2. ファイル数・変更行数の予測から推定
3. 明示されていない場合、**デフォルト: `size-S`**

**自動判定例**:

- 「タイポ修正」「リンク修正」 → `size-XS`
- 「新機能追加」「リファクタリング」 → `size-M`
- 「大規模な設計変更」「マイグレーション」 → `size-L`

---

### 4. ステータスラベル（Status）- **必須・排他的**

Issueの現在の状態を表すラベル。**1つのみ選択**。

| ラベル        | 説明                               | 遷移タイミング             |
| ------------- | ---------------------------------- | -------------------------- |
| `ready`       | 着手可能な状態                     | Issue作成時（デフォルト）  |
| `in-progress` | 作業中                             | 作業開始時                 |
| `review`      | レビュー待ち                       | PR作成時                   |
| `blocked`     | ブロック状態（外部要因で進めない） | 依存関係・外部要因で停止時 |

**判定ロジック**:

1. Issue作成時、**デフォルト: `ready`**
2. 作業開始時に手動で `in-progress` に変更
3. PR作成時に自動的に `review` に変更
4. ブロック要因が発生した場合に `blocked` に変更

**ライフサイクル**:

```
ready → in-progress → review → (close)
                   ↓
                blocked → (解消後) → in-progress
```

---

### 5. 領域ラベル（Area）- **オプション・複数可**

作業対象の技術領域を表すラベル。**複数選択可能**。

| ラベル     | 説明               | 自動判定キーワード                               |
| ---------- | ------------------ | ------------------------------------------------ |
| `frontend` | フロントエンド関連 | `UI`, `コンポーネント`, `画面`, `React`          |
| `backend`  | バックエンド関連   | `API`, `サーバー`, `tRPC`, `認証`                |
| `database` | データベース関連   | `DB`, `Supabase`, `スキーマ`, `マイグレーション` |
| `api`      | API関連            | `API`, `エンドポイント`, `REST`, `GraphQL`       |
| `ui`       | UI/UX関連          | `デザイン`, `スタイル`, `レイアウト`             |

**判定ロジック**:

1. タイトル・本文から技術キーワードを検出
2. 変更対象ファイルのディレクトリから推定
   - `src/components/`, `src/app/` → `frontend`, `ui`
   - `src/server/`, `src/pages/api/` → `backend`, `api`
   - `supabase/`, `prisma/` → `database`
3. 該当なしの場合、ラベル付与なし（必須ではない）

---

### 6. 関係性ラベル（Relationship）- **オプション・複数可**

他のIssueとの関係を表すラベル。**複数選択可能**。

| ラベル       | 説明                                   | 使用例                                      |
| ------------ | -------------------------------------- | ------------------------------------------- |
| `blocks`     | このIssueが他のIssueをブロックしている | 「このIssueが完了しないと #123 が進まない」 |
| `depends-on` | 他のIssueに依存している                | 「#456 が完了後に着手可能」                 |
| `related`    | 関連Issue（直接的な依存関係なし）      | 「#789 と関連するが独立して進められる」     |
| `follows`    | 前のIssueの続きの作業                  | 「#101 の続き、Phase 2」                    |
| `duplicates` | 重複Issue                              | 「#202 と重複」                             |
| `supersedes` | 既存Issueを置き換える                  | 「#303 を廃止し、この実装に統合」           |

**判定ロジック**:

1. 本文に `Blocks #123`, `Depends on #456` などの記述がある場合、自動付与
2. 明示的な関係性がない場合、ラベル付与なし

**GitHub連携**:

- `Closes #123` → Issueクローズ時に自動リンク
- `Blocks #123` → コメントで依存関係を明記

---

### 7. 特殊ラベル（Special）

| ラベル        | 説明                                      | 自動判定                           |
| ------------- | ----------------------------------------- | ---------------------------------- |
| `claude-code` | Claude Codeによる自動開発作業・AI作業ログ | Claude CodeがIssue作成時に自動付与 |

**判定ロジック**:

- Claude CodeがIssueを作成した場合、**自動的に付与**
- 手動作成の場合、付与しない

---

## 🤖 自動ラベル付与ルール

### Issue作成時の自動判定フロー

```
1. タイトル・本文解析
   ├─ 種別キーワード検出（新機能, バグ, リファクタ, etc.）
   │  └─ 種別ラベル決定
   ├─ 緊急性キーワード検出（緊急, critical, urgent, etc.）
   │  └─ 優先度ラベル決定
   ├─ 作業量キーワード検出（タイポ, 大規模, etc.）
   │  └─ サイズラベル決定
   └─ 技術キーワード検出（UI, API, DB, etc.）
      └─ 領域ラベル決定（複数可）

2. 関係性記述検出
   └─ 本文から Blocks, Depends on などを検出
      └─ 関係性ラベル決定（複数可）

3. デフォルト値適用
   ├─ 種別: feature（未指定時）
   ├─ 優先度: P3-low（未指定時）
   ├─ サイズ: size-S（未指定時）
   └─ ステータス: ready（常に）

4. 特殊ラベル
   └─ Claude Code作成の場合: claude-code 自動付与
```

---

## 📝 Issue作成例

### 例1: 新機能追加

**タイトル**: `ユーザープロフィール編集機能を追加`

**自動付与ラベル**:

- `feature`（「追加」キーワードから）
- `P3-low`（デフォルト）
- `size-M`（「機能を追加」から中規模と推定）
- `ready`（デフォルト）
- `frontend`, `ui`（「プロフィール編集」から）

**最終ラベル**: `feature, P3-low, size-M, ready, frontend, ui`

---

### 例2: 緊急バグ修正

**タイトル**: `本番環境でログインできないバグを緊急修正`

**自動付与ラベル**:

- `bug`（「バグ」キーワードから）
- `P0-urgent`（「緊急」キーワードから）
- `size-S`（「修正」キーワードから小規模と推定）
- `ready`（デフォルト）
- `backend`, `api`（「ログイン」から）

**最終ラベル**: `bug, P0-urgent, size-S, ready, backend, api`

---

### 例3: ドキュメント更新

**タイトル**: `README.mdのセットアップ手順を更新`

**自動付与ラベル**:

- `docs`（「README」「更新」キーワードから）
- `P3-low`（デフォルト）
- `size-XS`（「更新」キーワードから軽微と推定）
- `ready`（デフォルト）

**最終ラベル**: `docs, P3-low, size-XS, ready`

---

### 例4: 依存関係のあるリファクタリング

**タイトル**: `認証システムの大規模リファクタリング`

**本文**:

```
Depends on #500
Blocks #501, #502
```

**自動付与ラベル**:

- `refactor`（「リファクタリング」キーワードから）
- `P2-medium`（「大規模」から重要度を上げる）
- `size-L`（「大規模」キーワードから）
- `ready`（デフォルト）
- `backend`, `api`（「認証システム」から）
- `depends-on`, `blocks`（本文の記述から）

**最終ラベル**: `refactor, P2-medium, size-L, ready, backend, api, depends-on, blocks`

---

## 🚫 禁止事項

### 同一カテゴリの複数ラベル付与禁止

❌ **NG例**:

```
feature, bug  （種別は1つのみ）
P1-high, P3-low  （優先度は1つのみ）
size-S, size-L  （サイズは1つのみ）
ready, in-progress  （ステータスは1つのみ）
```

✅ **OK例**:

```
feature, P2-medium, size-M, ready  （各カテゴリ1つずつ）
bug, P0-urgent, size-S, in-progress, frontend, backend  （領域は複数可）
refactor, P3-low, size-L, blocked, depends-on, blocks  （関係性は複数可）
```

---

## 🔄 ラベル変更のタイミング

### 自動変更

| イベント         | ラベル変更                |
| ---------------- | ------------------------- |
| 作業開始         | `ready` → `in-progress`   |
| PR作成           | `in-progress` → `review`  |
| ブロック発生     | `in-progress` → `blocked` |
| ブロック解消     | `blocked` → `in-progress` |
| 優先度変更の依頼 | 優先度ラベルを手動更新    |
| スコープ変更     | サイズラベルを手動更新    |

### 手動変更が必要な場合

- 作業中にスコープが大幅に変更された → サイズラベルを更新
- 緊急度が変わった → 優先度ラベルを更新
- 種別を間違えた → 種別ラベルを修正

---

## 🔗 関連ドキュメント

- **Issue管理ルール**: [`ISSUE_MANAGEMENT.md`](./ISSUE_MANAGEMENT.md)
- **セッション管理**: [`CLAUDE_SESSION_MANAGEMENT.md`](./CLAUDE_SESSION_MANAGEMENT.md)
- **Claude Code作業規範**: [`/CLAUDE.md`](../../CLAUDE.md)

---

## 📊 ラベル統計（参考）

定期的にラベル使用状況を確認し、運用を改善：

```bash
# ラベル別Issue数の確認
gh issue list --label "feature" --state all | wc -l
gh issue list --label "P0-urgent" --state all | wc -l

# 長期未解決Issue
gh issue list --state open --label "in-progress" --json createdAt,title
```

---

**📖 最終更新**: 2025-10-10
**バージョン**: v1.2 - 技術的な議論・アイデアなども気軽にIssue化OK
