# Claude 4 プロンプトエンジニアリング ベストプラクティス

> **参照元**: [Anthropic公式ドキュメント](https://docs.anthropic.com/en/docs/build-with-claude/prompt-engineering/claude-4-best-practices)

このドキュメントは、Claude 4モデル（Opus 4.5、Opus 4、Sonnet 4）の特性を理解し、最適な結果を得るためのガイドラインです。

---

## 🎯 目的

1. **開発者向け**: Claude Codeに指示を出す際のベストプラクティスを理解する
2. **Claude Code向け**: 開発者の指示が不明確な場合に適切な質問を投げかける
3. **相互改善**: より良いコミュニケーションでプロジェクト品質を向上させる

---

## 📋 Claude 4モデルの特性

### 従来モデルとの違い

Claude 4モデルは**より正確な指示追従**のためにトレーニングされています。

| 特性 | 従来モデル | Claude 4モデル |
|------|-----------|---------------|
| 指示解釈 | 意図を推測して拡張 | 指示を文字通りに実行 |
| 出力スタイル | 詳細・冗長になりがち | 簡潔・直接的 |
| ツール呼び出し後 | 口頭で要約 | 次のアクションに直行 |

### 重要な示唆

- ❌ 「Claude 4は指示通りにしかやらない」
- ✅ 「Claude 4は指示を正確に実行するので、**明確な指示が必要**」

---

## 🔑 5つの核心原則

### 1. 明示的な指示を出す (Be Explicit)

Claude 4は明確で具体的な指示に対して最適に応答します。

```markdown
# ❌ 曖昧な指示
「ログイン機能を作って」

# ✅ 明示的な指示
「ログイン機能を作成してください。以下の要件を満たすこと:
- メールアドレスとパスワードでの認証
- Supabase Authを使用
- バリデーションエラーは日本語で表示
- 成功時は/dashboardにリダイレクト」
```

**Claude Codeへの指示**: 開発者の指示が曖昧な場合は、以下のように確認を求める:

```
「ログイン機能について、以下の点を確認させてください:
1. 認証方式: メール/パスワード、OAuth、Magic Link のどれですか？
2. 使用するライブラリ: Supabase Auth を使用しますか？
3. エラーハンドリング: どのようなエラーメッセージを表示しますか？」
```

---

### 2. 背景と動機を説明する (Provide Context)

「なぜ」を説明すると、Claude 4はより適切に一般化できます。

```markdown
# ❌ ルールだけを伝える
「絶対にエリプシス（…）を使わないで」

# ✅ 理由と共に伝える
「レスポンスは音声合成エンジンで読み上げられるため、
エリプシス（…）は使用しないでください。
音声合成エンジンは発音方法がわからないためです。」
```

**開発者へのガイドライン**: 制約やルールを設ける際は、その理由を必ず添える。

---

### 3. 例を慎重に選ぶ (Be Vigilant with Examples)

Claude 4は提供された例の詳細に注目し、パターンを学習します。

```markdown
# ❌ 悪い例の提供（望ましくない形式を含む）
「出力は以下のような形式で:
- name: John Doe  ← これはダメ
- name: 田中太郎  ← これが正しい」

# ✅ 良い例のみ提供
「出力は以下の形式で:
- name: 田中太郎
- name: 佐藤花子
- name: 鈴木一郎」
```

**重要**: 「やってはいけない例」を見せると、それを学習してしまう可能性がある。

---

### 4. 長時間推論タスクへの対応 (Long-Horizon Reasoning)

Claude 4.5は複数のコンテキストウィンドウにまたがる長期タスクに優れています。

**推奨アプローチ**:

```markdown
# 複雑なタスクの分解
「このリファクタリングを以下のステップで進めてください:
1. まず影響範囲を調査
2. 変更計画を提案
3. 承認後、段階的に実装
4. 各ステップで進捗を報告」
```

**状態追跡のヒント**:
- 進捗ファイルを作成して状態を記録
- 次のセッションで参照できる形式で残す
- 一度に全てをやろうとせず、着実に進める

---

### 5. 拡張思考の活用 (Extended Thinking)

複雑な推論タスクでは、拡張思考を有効にすることで精度が向上します。

**適切なケース**:
- 複雑なアルゴリズム設計
- 多段階の問題解決
- ツール使用後の振り返り
- アーキテクチャ決定

**不適切なケース**:
- 単純なコード修正
- 定型的なタスク
- 即座に回答できる質問

---

## 🔄 開発者とClaude Codeの相互作用

### 開発者が守るべきベストプラクティス

#### 1. 指示は具体的に

```markdown
# ❌ 避けるべき
「このコンポーネントを改善して」

# ✅ 推奨
「UserCardコンポーネントについて:
- ローディング状態のスケルトンを追加
- エラー状態のハンドリングを実装
- アクセシビリティ属性（aria-label等）を追加」
```

#### 2. 出力形式を明確に

```markdown
# ❌ 曖昧
「結果を教えて」

# ✅ 明確
「結果を以下の形式で出力してください:
## 変更したファイル
- ファイルパス: 変更内容

## 動作確認
- [ ] チェック項目1
- [ ] チェック項目2」
```

#### 3. 制約は理由と共に

```markdown
# ❌ ルールだけ
「useEffectは使わないで」

# ✅ 理由付き
「データフェッチングにuseEffectは使用しないでください。
理由: Next.js 14ではServer Componentsまたは
TanStack Queryでのデータ取得が推奨されているためです。」
```

---

### Claude Codeが実践すべきベストプラクティス

#### 1. 曖昧な指示への対応

開発者の指示が不明確な場合、以下のテンプレートで確認:

```markdown
「ご依頼を確認させてください。以下の点が明確でないため、
作業前に確認したいと思います:

**確認事項**:
1. [具体的な質問1]
2. [具体的な質問2]

**現時点での理解**:
- [理解している内容を記述]

**想定される選択肢**:
- A案: [選択肢Aの説明]
- B案: [選択肢Bの説明]

どちらの方向で進めますか？」
```

#### 2. ベストプラクティス違反の検出

開発者の指示がベストプラクティスに反する場合:

```markdown
「ご依頼の実装方法について、一点確認させてください。

**現在のご依頼**:
[依頼内容]

**懸念事項**:
[公式ドキュメント/ベストプラクティス]では、
[推奨される方法]が推奨されています。

**理由**:
[なぜその方法が推奨されるか]

**提案**:
[代替案の提示]

このまま進めますか？それとも推奨される方法で実装しますか？」
```

#### 3. 実装前の確認チェックリスト

大きな変更を行う前に自問する:

- [ ] 開発者の意図を正しく理解しているか？
- [ ] 既存の実装パターンを確認したか？
- [ ] 公式ドキュメントの推奨に沿っているか？
- [ ] セキュリティ上の問題はないか？
- [ ] パフォーマンスへの影響は考慮したか？

---

## 📝 チェックリスト

### 開発者向けチェックリスト

指示を出す前に確認:

- [ ] **明示的**: 期待する結果を具体的に記述したか？
- [ ] **背景説明**: なぜその実装が必要か説明したか？
- [ ] **良い例のみ**: 望ましい例だけを提供したか？
- [ ] **出力形式**: 期待する出力形式を指定したか？
- [ ] **制約と理由**: 制約がある場合、理由も説明したか？

### Claude Code向けチェックリスト

実装前に確認:

- [ ] **理解確認**: 曖昧な点があれば質問したか？
- [ ] **既存確認**: 類似実装が既に存在しないか確認したか？
- [ ] **公式準拠**: 公式ドキュメントの推奨に沿っているか？
- [ ] **CLAUDE.md準拠**: プロジェクトルールに従っているか？
- [ ] **例外報告**: ベストプラクティスに反する場合、報告したか？

---

## 🔗 関連リソース

### Anthropic公式

- [Claude 4 Best Practices](https://docs.anthropic.com/en/docs/build-with-claude/prompt-engineering/claude-4-best-practices)
- [Prompt Engineering Interactive Tutorial](https://github.com/anthropics/prompt-eng-interactive-tutorial)
- [Claude Code Best Practices](https://www.anthropic.com/engineering/claude-code-best-practices)

### プロジェクト内ドキュメント

- [CLAUDE.md](../../CLAUDE.md) - AI意思決定プロトコル
- [src/CLAUDE.md](../../src/CLAUDE.md) - 実装リファレンス
- [CLAUDE_SESSION_MANAGEMENT.md](./CLAUDE_SESSION_MANAGEMENT.md) - セッション管理

---

**最終更新**: 2025-12-24 | **バージョン**: v1.0
