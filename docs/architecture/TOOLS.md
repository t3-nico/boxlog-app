# ツールの役割と相互作用

BoxLogで使用しているツールの役割と、どう連携しているかを解説する。

## ツール一覧

| ツール              | 役割             | 採用理由                            |
| ------------------- | ---------------- | ----------------------------------- |
| **Next.js 15**      | フレームワーク   | Reactの公式推奨、Vercelとの親和性   |
| **React 19**        | UIライブラリ     | 業界標準、Server Componentsサポート |
| **TypeScript**      | 型システム       | 型安全性、IDE補完、バグ防止         |
| **tRPC v11**        | API通信          | E2E型安全、コード量削減             |
| **Zustand**         | 状態管理         | シンプル、Redux不要                 |
| **TanStack Query**  | サーバー状態     | キャッシング、リフェッチ            |
| **Supabase**        | BaaS             | 認証、DB、リアルタイム一体型        |
| **Tailwind CSS v4** | スタイリング     | ユーティリティファースト            |
| **shadcn/ui**       | UIコンポーネント | カスタマイズ可能、Radix UIベース    |
| **Zod**             | バリデーション   | 型推論、tRPCと統合                  |

## 相互作用図

```
┌─────────────────────────────────────────────────────────┐
│                    Frontend                             │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐ │
│  │  shadcn/ui  │───▶│    React    │◀───│  Tailwind   │ │
│  │  (UI部品)   │    │ (Component) │    │  (Style)    │ │
│  └─────────────┘    └──────┬──────┘    └─────────────┘ │
│                            │                            │
│                            ▼                            │
│  ┌─────────────┐    ┌─────────────┐                    │
│  │   Zustand   │◀──▶│TanStack Query│                   │
│  │  (UI状態)   │    │(サーバー状態)│                   │
│  └─────────────┘    └──────┬──────┘                    │
│                            │                            │
│                            ▼                            │
│                    ┌─────────────┐                      │
│                    │ tRPC Client │                      │
│                    │ (型安全API) │                      │
│                    └──────┬──────┘                      │
└────────────────────────────┼────────────────────────────┘
                             │
                             ▼
┌─────────────────────────────────────────────────────────┐
│                    Backend                              │
├─────────────────────────────────────────────────────────┤
│                    ┌─────────────┐                      │
│                    │ tRPC Router │                      │
│                    │ (+ Zod)     │                      │
│                    └──────┬──────┘                      │
│                            │                            │
│                            ▼                            │
│                    ┌─────────────┐                      │
│                    │   Service   │                      │
│                    │   Layer     │                      │
│                    └──────┬──────┘                      │
│                            │                            │
│                            ▼                            │
│                    ┌─────────────┐                      │
│                    │  Supabase   │                      │
│                    │ (Auth+DB)   │                      │
│                    └─────────────┘                      │
└─────────────────────────────────────────────────────────┘
```

## 各ツールの詳細

### Next.js 15 (App Router)

**役割**: アプリケーションフレームワーク

**主な機能**:

- ルーティング（ファイルベース）
- Server Components / Client Components
- API Routes → tRPCで置き換え済み
- 画像最適化（next/image）

**GAFAでの採用**:

- Googleの一部プロダクト
- Netflix（部分的）

### tRPC v11

**役割**: 型安全なAPI通信

**仕組み**:

```
[Client] ←─── 型情報 ───→ [Server]
          コンパイル時に検証
```

**メリット**:

- APIスキーマの自動生成不要
- 型の不整合がコンパイルエラーに
- REST APIより少ないコード

### Zustand

**役割**: クライアント状態管理

**Reduxとの違い**:
| 項目 | Redux | Zustand |
|------|-------|---------|
| ボイラープレート | 多い | 少ない |
| 学習コスト | 高い | 低い |
| ミドルウェア | 必須 | オプション |
| DevTools | あり | あり |

**使い方**:

```typescript
// Store定義
const useStore = create((set) => ({
  count: 0,
  increment: () => set((state) => ({ count: state.count + 1 })),
}));

// 使用
const count = useStore((state) => state.count);
```

### TanStack Query

**役割**: サーバー状態の管理・キャッシング

**主な機能**:

- データのキャッシング
- 自動リフェッチ
- 楽観的更新
- 無限スクロール

**Zustandとの使い分け**:

- **TanStack Query**: サーバーから取得したデータ
- **Zustand**: UIの状態（サイドバー、選択状態など）

### Supabase

**役割**: Backend as a Service

**提供機能**:

- **認証**: Email/Password, OAuth, MFA
- **データベース**: PostgreSQL
- **RLS**: 行レベルセキュリティ
- **リアルタイム**: WebSocket
- **ストレージ**: ファイル保存

**なぜFirebaseではなくSupabaseか**:

- PostgreSQL（SQLが使える）
- RLSによるセキュリティ
- オープンソース

## 関連ドキュメント

- [DATA_FLOW.md](./DATA_FLOW.md) - データの流れ
- [PATTERNS.md](./PATTERNS.md) - 設計パターン
