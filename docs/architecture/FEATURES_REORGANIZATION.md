# Features å†ç·¨æˆè¨ˆç”»

## ğŸ“Š ç¾çŠ¶åˆ†æï¼ˆ2025-10-27ï¼‰

### å…¨Featuresãƒªã‚¹ãƒˆï¼ˆ21å€‹ï¼‰

```
src/features/
â”œâ”€â”€ aichat/           âœ… ãã®ã¾ã¾ç¶­æŒ
â”œâ”€â”€ auth/             âœ… ãã®ã¾ã¾ç¶­æŒ
â”œâ”€â”€ board/            ğŸ”„ çµ±åˆå¯¾è±¡
â”œâ”€â”€ calendar/         ğŸ”„ çµ±åˆå¯¾è±¡
â”œâ”€â”€ command-palette/  âœ… ãã®ã¾ã¾ç¶­æŒ
â”œâ”€â”€ events/           ğŸ”„ çµ±åˆå¯¾è±¡
â”œâ”€â”€ help/             âœ… ãã®ã¾ã¾ç¶­æŒ
â”œâ”€â”€ i18n/             âœ… ãã®ã¾ã¾ç¶­æŒ
â”œâ”€â”€ inspector/        âœ… ãã®ã¾ã¾ç¶­æŒ
â”œâ”€â”€ navigation/       âœ… ãã®ã¾ã¾ç¶­æŒ
â”œâ”€â”€ notifications/    âœ… ãã®ã¾ã¾ç¶­æŒ
â”œâ”€â”€ offline/          âœ… ãã®ã¾ã¾ç¶­æŒ
â”œâ”€â”€ search/           âœ… ãã®ã¾ã¾ç¶­æŒ
â”œâ”€â”€ settings/         âœ… ãã®ã¾ã¾ç¶­æŒ
â”œâ”€â”€ smart-folders/    âœ… ãã®ã¾ã¾ç¶­æŒ
â”œâ”€â”€ stats/            âœ… ãã®ã¾ã¾ç¶­æŒ
â”œâ”€â”€ table/            ğŸ”„ çµ±åˆå¯¾è±¡
â”œâ”€â”€ tags/             âœ… ãã®ã¾ã¾ç¶­æŒ
â”œâ”€â”€ tasks/            âš ï¸ å‰Šé™¤äºˆå®šï¼ˆsessionsã«çµ±åˆï¼‰
â”œâ”€â”€ plans/          ğŸ†• æ–°è¦å®Ÿè£…æ¸ˆã¿ï¼ˆPhase 3å®Œäº†ï¼‰
â””â”€â”€ trash/            âœ… ãã®ã¾ã¾ç¶­æŒ
```

---

## ğŸ¯ æ–°ã—ã„ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### ãƒ‡ãƒ¼ã‚¿ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼ˆã‚³ã‚¢ãƒ‰ãƒ¡ã‚¤ãƒ³ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         planï¼ˆè¦ªï¼šä½œæ¥­å˜ä½ï¼‰            â”‚
â”‚  - ID, ã‚¿ã‚¤ãƒˆãƒ«, èª¬æ˜                    â”‚
â”‚  - ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹, å„ªå…ˆåº¦                    â”‚
â”‚  - äºˆå®šæ™‚é–“ vs å®Ÿç¸¾æ™‚é–“ï¼ˆè‡ªå‹•é›†è¨ˆï¼‰       â”‚
â”‚  - ã‚¿ã‚°ã€ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
         â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
         â”‚  Sessions  â”‚
         â”‚ ï¼ˆå­ï¼šä½œæ¥­æ™‚é–“ï¼‰â”‚
         â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
               â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚          â”‚          â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”€â”  â”Œâ”€â”€â–¼â”€â”€â”€â”  â”Œâ”€â”€â–¼â”€â”€â”€â”
â”‚SES-001â”‚  â”‚SES-002â”‚  â”‚SES-003â”‚
â”‚å®Œäº†   â”‚  â”‚å®Œäº†   â”‚  â”‚äºˆå®š   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜
```

### ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼ˆãƒ“ãƒ¥ãƒ¼ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Sessions Data                â”‚
â”‚  (planã¨ã®é–¢é€£æƒ…å ±ã‚’å«ã‚€)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚        â”‚        â”‚
  â”Œâ”€â”€â”€â–¼â”€â”€â”€â”â”Œâ”€â”€â–¼â”€â”€â”€â”€â”â”Œâ”€â”€â–¼â”€â”€â”€â”€â”
  â”‚Calendarâ”‚â”‚ Board  â”‚â”‚ Table â”‚
  â”‚       â”‚â”‚        â”‚â”‚       â”‚
  â”‚æ™‚é–“è»¸  â”‚â”‚ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹â”‚â”‚ä¸€è¦§   â”‚
  â”‚ã§è¡¨ç¤º  â”‚â”‚åˆ¥ã§è¡¨ç¤ºâ”‚â”‚ã§è¡¨ç¤º  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ çµ±åˆãƒ»ç§»è¡Œè¨ˆç”»

### Phase 1: ãƒ‡ãƒ¼ã‚¿çµ±åˆï¼ˆå„ªå…ˆåº¦ï¼šé«˜ï¼‰

#### 1. **`tasks` â†’ `sessions`** ã¸ã®ç§»è¡Œ

**ç¾çŠ¶ã®`tasks`**:

```typescript
// src/features/tasks/stores/useTaskStore.ts
Task {
  id: string
  title: string
  planned_start: Date
  planned_duration: number
  status: TaskStatus
  priority: TaskPriority
  description?: string
  tags?: string[]
}
```

**ç§»è¡Œå¾Œã®`sessions`**:

```typescript
// src/features/plans/stores/useSessionStore.ts
Session {
  id: string
  plan_id: string        // â† planã¸ã®å‚ç…§ï¼ˆå¿…é ˆï¼‰
  session_number: string   // è‡ªå‹•æ¡ç•ª
  title: string
  planned_start?: string
  planned_end?: string
  actual_start?: string
  actual_end?: string
  status: SessionStatus
  duration_minutes?: number
  notes?: string
  tags: Tag[]              // ã‚¿ã‚°é–¢é€£ä»˜ã‘
}
```

**ç§»è¡Œã‚¹ãƒ†ãƒƒãƒ—**:

1. âœ… `useSessionStore`å®Ÿè£…æ¸ˆã¿ï¼ˆPhase 3å®Œäº†ï¼‰
2. âœ… `useSessions`ãƒ•ãƒƒã‚¯å®Ÿè£…æ¸ˆã¿ï¼ˆPhase 3å®Œäº†ï¼‰
3. â³ ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é–¢æ•°ä½œæˆ
   ```typescript
   // src/features/plans/utils/migrateTasksToSessions.ts
   function migrateTaskToSession(task: Task): Session {
     return {
       id: generateUUID(),
       plan_id: createDefaultplan(task).id, // æ—¢å­˜taskã¯æ–°è¦planã‚’è‡ªå‹•ä½œæˆ
       session_number: generateSessionNumber(),
       title: task.title,
       planned_start: task.planned_start.toISOString(),
       planned_end: addMinutes(task.planned_start, task.planned_duration).toISOString(),
       status: mapTaskStatusToSessionStatus(task.status),
       // ...
     }
   }
   ```
4. â³ æ®µéšçš„ç§»è¡Œï¼ˆæ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã‚’å£Šã•ãªã„ï¼‰
   - Week 1: SessionStoreä¸¦è¡Œç¨¼åƒï¼ˆtasksã¨sessionsã®ä¸¡æ–¹ã‚’ä¿æŒï¼‰
   - Week 2: ãƒ“ãƒ¥ãƒ¼ã§sessionså„ªå…ˆè¡¨ç¤ºï¼ˆtasksã¯ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰
   - Week 3: tasksã®æ–°è¦ä½œæˆã‚’åœæ­¢ï¼ˆsessionsã®ã¿ï¼‰
   - Week 4: tasksã®å®Œå…¨å‰Šé™¤

#### 2. **`events` ã¨ `sessions`** ã®æ£²ã¿åˆ†ã‘

| é …ç›®               | Events             | Sessions             |
| ------------------ | ------------------ | -------------------- |
| **ç”¨é€”**           | ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆ | ä½œæ¥­ã‚»ãƒƒã‚·ãƒ§ãƒ³       |
| **ä¾‹**             | ä¼šè­°ã€ç· åˆ‡ã€äºˆå®š   | å®Ÿè£…ä½œæ¥­ã€ãƒ¬ãƒ“ãƒ¥ãƒ¼   |
| **è¦ªã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£** | ãªã—ï¼ˆå˜ç‹¬ï¼‰       | planï¼ˆå¿…é ˆï¼‰         |
| **æ™‚é–“ç®¡ç†**       | é–‹å§‹ãƒ»çµ‚äº†æ™‚åˆ»     | å®Ÿç¸¾æ™‚é–“ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚° |
| **ç¹°ã‚Šè¿”ã—**       | âœ… ã‚µãƒãƒ¼ãƒˆ        | âŒ ã‚µãƒãƒ¼ãƒˆãªã—      |
| **ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ** | âœ… ã‚µãƒãƒ¼ãƒˆ        | âŒ ã‚µãƒãƒ¼ãƒˆãªã—      |

**çµ±åˆãƒã‚¤ãƒ³ãƒˆ**:

- ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ“ãƒ¥ãƒ¼ã§ã¯**ä¸¡æ–¹ã‚’è¡¨ç¤º**
- Eventsã¨Sessionsã¯åˆ¥ã€…ã®ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã ãŒã€UIã§ã¯çµ±åˆè¡¨ç¤º
- Sessionä½œæˆæ™‚ã«Eventã‚’è‡ªå‹•ä½œæˆã™ã‚‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼ˆå°†æ¥æ‹¡å¼µï¼‰

---

### Phase 2: ãƒ“ãƒ¥ãƒ¼çµ±åˆï¼ˆå„ªå…ˆåº¦ï¼šä¸­ï¼‰

#### 1. **Calendar** - Events + Sessionsçµ±åˆè¡¨ç¤º

```typescript
// src/features/calendar/hooks/useCalendarData.ts
export function useCalendarData() {
  const { events } = useEventStore()
  const { sessions } = useSessionStore()

  // çµ±åˆã—ã¦è¡¨ç¤º
  const calendarItems = useMemo(() => {
    const eventItems = events.map((e) => ({
      type: 'event' as const,
      id: e.id,
      title: e.title,
      start: e.startDate,
      end: e.endDate,
      color: e.color,
      source: e,
    }))

    const sessionItems = sessions.map((s) => ({
      type: 'session' as const,
      id: s.id,
      title: s.title,
      start: s.actual_start || s.planned_start,
      end: s.actual_end || s.planned_end,
      color: getSessionColor(s.status),
      source: s,
      planInfo: getplanById(s.plan_id), // planæƒ…å ±ã‚‚å«ã‚ã‚‹
    }))

    return [...eventItems, ...sessionItems]
  }, [events, sessions])

  return { calendarItems }
}
```

#### 2. **Board** - planå˜ä½ã§è¡¨ç¤ºï¼ˆSessionæƒ…å ±å«ã‚€ï¼‰

```typescript
// src/features/board/components/planCard.tsx
export function planCard({ plan }: { plan: plan }) {
  const { sessions } = useSessions()
  const planSessions = sessions.filter(s => s.plan_id === plan.id)

  const completedSessions = planSessions.filter(s => s.status === 'completed')
  const totalMinutes = completedSessions.reduce((sum, s) => sum + (s.duration_minutes || 0), 0)

  return (
    <Card>
      <h3>{plan.title}</h3>
      <Badge>{plan.status}</Badge>

      {/* é€²æ—è¡¨ç¤º */}
      <Progress
        value={plan.actual_hours}
        max={plan.planned_hours}
        label={`${plan.actual_hours}h / ${plan.planned_hours}h`}
      />

      {/* Sessionæƒ…å ± */}
      <div>
        <p>ğŸ“‹ {planSessions.length} sessions</p>
        <p>âœ“ {completedSessions.length} å®Œäº†</p>
        <p>â³ {planSessions.length - completedSessions.length} äºˆå®š</p>
      </div>

      {/* ãƒŸãƒ‹ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼: ä»Šé€±ã®Session */}
      <SessionTimeline sessions={planSessions} />
    </Card>
  )
}
```

#### 3. **Table** - Sessionä¸€è¦§è¡¨ç¤ºï¼ˆplanæƒ…å ±å«ã‚€ï¼‰

```typescript
// src/features/table/components/SessionTable.tsx
export function SessionTable() {
  const { sessions } = useSessions()
  const { getplanById } = useplans()

  const columns = [
    { key: 'session_number', label: 'Session No.' },
    { key: 'plan_number', label: 'plan',
      render: (s) => getplanById(s.plan_id)?.plan_number
    },
    { key: 'title', label: 'Title' },
    { key: 'actual_start', label: 'Start' },
    { key: 'duration_minutes', label: 'Duration',
      render: (s) => s.duration_minutes ? `${s.duration_minutes / 60}h` : '-'
    },
    { key: 'status', label: 'Status' },
  ]

  return <DataTable data={sessions} columns={columns} />
}
```

---

## ğŸ“ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ï¼ˆæœ€çµ‚å½¢ï¼‰

```
src/features/
â”œâ”€â”€ plans/           # ã‚³ã‚¢ãƒ‰ãƒ¡ã‚¤ãƒ³
â”‚   â”œâ”€â”€ stores/
â”‚   â”‚   â”œâ”€â”€ useplanStore.ts      âœ… å®Ÿè£…æ¸ˆã¿
â”‚   â”‚   â””â”€â”€ useSessionStore.ts     âœ… å®Ÿè£…æ¸ˆã¿
â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”œâ”€â”€ useplans.ts          âœ… å®Ÿè£…æ¸ˆã¿
â”‚   â”‚   â”œâ”€â”€ useSessions.ts         âœ… å®Ÿè£…æ¸ˆã¿
â”‚   â”‚   â””â”€â”€ useplanTags.ts       âœ… å®Ÿè£…æ¸ˆã¿
â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â”œâ”€â”€ plan.ts              âœ… å®Ÿè£…æ¸ˆã¿
â”‚   â”‚   â””â”€â”€ session.ts             âœ… å®Ÿè£…æ¸ˆã¿
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â””â”€â”€ migrateTasksToSessions.ts  â³ TODO
â”‚   â””â”€â”€ components/                â³ Phase 4ã§å®Ÿè£…
â”‚       â”œâ”€â”€ planForm.tsx
â”‚       â”œâ”€â”€ SessionForm.tsx
â”‚       â””â”€â”€ planDetail.tsx
â”‚
â”œâ”€â”€ calendar/          # ãƒ“ãƒ¥ãƒ¼ï¼ˆEvents + Sessionsçµ±åˆè¡¨ç¤ºï¼‰
â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â””â”€â”€ useCalendarData.ts     ğŸ”„ ä¿®æ­£å¿…è¦ï¼ˆSessionsçµ±åˆï¼‰
â”‚   â””â”€â”€ components/
â”‚       â””â”€â”€ CalendarView.tsx       ğŸ”„ ä¿®æ­£å¿…è¦
â”‚
â”œâ”€â”€ board/             # ãƒ“ãƒ¥ãƒ¼ï¼ˆplanå˜ä½è¡¨ç¤ºï¼‰
â”‚   â”œâ”€â”€ stores/
â”‚   â”‚   â””â”€â”€ useKanbanStore.ts      ğŸ”„ ä¿®æ­£å¿…è¦ï¼ˆplanãƒ™ãƒ¼ã‚¹ã«ï¼‰
â”‚   â””â”€â”€ components/
â”‚       â””â”€â”€ planCard.tsx         ğŸ”„ ä¿®æ­£å¿…è¦
â”‚
â”œâ”€â”€ table/             # ãƒ“ãƒ¥ãƒ¼ï¼ˆSessionä¸€è¦§è¡¨ç¤ºï¼‰
â”‚   â””â”€â”€ components/
â”‚       â””â”€â”€ SessionTable.tsx       ğŸ”„ ä¿®æ­£å¿…è¦
â”‚
â”œâ”€â”€ events/            # ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆå°‚ç”¨
â”‚   â””â”€â”€ ...                        âœ… ãã®ã¾ã¾ç¶­æŒ
â”‚
â””â”€â”€ tasks/             # âš ï¸ å‰Šé™¤äºˆå®š
    â””â”€â”€ ...                        ğŸ—‘ï¸ Phase 1å®Œäº†å¾Œã«å‰Šé™¤
```

---

## âœ… ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¢ã‚¤ãƒ†ãƒ 

### å„ªå…ˆåº¦ï¼šé«˜ï¼ˆPhase 4ï¼‰

- [ ] ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é–¢æ•°å®Ÿè£…
  - `migrateTasksToSessions.ts`
  - LocalStorage â†’ Supabaseç§»è¡Œãƒ„ãƒ¼ãƒ«
- [ ] Calendarãƒ“ãƒ¥ãƒ¼çµ±åˆ
  - `useCalendarData`ã«Sessionsè¿½åŠ 
  - Eventã¨Sessionã®è¦‹åˆ†ã‘æ–¹ï¼ˆè‰²ãƒ»ã‚¢ã‚¤ã‚³ãƒ³ï¼‰
- [ ] Boardãƒ“ãƒ¥ãƒ¼çµ±åˆ
  - planãƒ™ãƒ¼ã‚¹ã®ã‚«ãƒ¼ãƒ‰è¡¨ç¤º
  - Sessioné€²æ—æƒ…å ±ã®è¡¨ç¤º

### å„ªå…ˆåº¦ï¼šä¸­ï¼ˆPhase 5ï¼‰

- [ ] Tableãƒ“ãƒ¥ãƒ¼çµ±åˆ
  - Sessionä¸€è¦§è¡¨ç¤º
  - planæƒ…å ±ã¨ã®ç´ä»˜ã‘
- [ ] UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå®Ÿè£…
  - planForm, SessionForm
  - planDetailï¼ˆSessionä¸€è¦§å«ã‚€ï¼‰

### å„ªå…ˆåº¦ï¼šä½ï¼ˆPhase 6ä»¥é™ï¼‰

- [ ] é«˜åº¦ãªæ©Ÿèƒ½
  - Session â†’ Eventè‡ªå‹•å¤‰æ›
  - ã‚¬ãƒ³ãƒˆãƒãƒ£ãƒ¼ãƒˆè¡¨ç¤º
  - æ™‚é–“åˆ†æãƒ»ãƒ¬ãƒãƒ¼ãƒˆ

---

## ğŸ“Š ç§»è¡Œã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«

| ãƒ•ã‚§ãƒ¼ã‚º | æœŸé–“     | å†…å®¹                               | çŠ¶æ…‹      |
| -------- | -------- | ---------------------------------- | --------- |
| Phase 1  | Week 1   | Databaseè¨­è¨ˆãƒ»Migration            | âœ… å®Œäº†   |
| Phase 2  | Week 2   | tRPC API + Zod                     | â³ é€²è¡Œä¸­ |
| Phase 3  | Week 3   | Zustand Store + Hooks              | âœ… å®Œäº†   |
| Phase 4  | Week 4-5 | ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³             | â³ TODO   |
| Phase 5  | Week 6-7 | ãƒ“ãƒ¥ãƒ¼çµ±åˆï¼ˆCalendar/Board/Tableï¼‰ | â³ TODO   |
| Phase 6  | Week 8+  | é«˜åº¦ãªæ©Ÿèƒ½ãƒ»æœ€é©åŒ–                 | â³ TODO   |

---

**æœ€çµ‚æ›´æ–°**: 2025-10-27
**ä½œæˆè€…**: Claude + User
**é–¢é€£Issue**: #620, #621
