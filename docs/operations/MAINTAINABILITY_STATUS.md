# BoxLog 保守性現状レポート

> 最終更新: 2025-12-26 | スコア: 88/100

## 概要

BoxLogのコード保守性の現状をまとめたドキュメントです。

## 保守性スコア

| カテゴリ       | スコア     | 状態        |
| -------------- | ---------- | ----------- |
| 依存関係管理   | 9/10       | ✅ 良好     |
| 非推奨API対応  | 10/10      | ✅ 優秀     |
| コードの一貫性 | 8/10       | ✅ 良好     |
| ドキュメント   | 9/10       | ✅ 良好     |
| 型安全性       | 9/10       | ✅ 良好     |
| **総合**       | **88/100** | **✅ 良好** |

---

## 1. 依存関係管理 (9/10)

### 実装済み

| 対策                    | 状態      | 詳細                        |
| ----------------------- | --------- | --------------------------- |
| **脆弱性ゼロ**          | ✅ 達成   | npm audit 0 vulnerabilities |
| **Dependabot**          | ✅ 設定済 | 週次自動更新                |
| **重複ライブラリなし**  | ✅ 達成   | 日付: date-fns のみ         |
| **devDependencies分離** | ✅ 適切   | 本番/開発依存が分離         |
| **ライセンスチェック**  | ✅ 設定済 | 週次実行                    |

### Dependabot 設定

```yaml
# 自動更新対象
- npm dependencies（週1回・月曜9:00 JST）
- GitHub Actions（週1回）

# グループ化
- production: minor/patch をまとめて更新
- development: minor/patch をまとめて更新

# 除外
- Major バージョン更新（手動対応）
```

### 改善候補

- [ ] knip設定追加（未使用依存の自動検出）

---

## 2. 非推奨API対応 (10/10)

### 完全対応済み

| 項目                         | 状態        | 詳細                      |
| ---------------------------- | ----------- | ------------------------- |
| **next/router → navigation** | ✅ 対応済み | next/navigation を使用    |
| **React.FC**                 | ✅ 不使用   | CLAUDE.md で禁止          |
| **getServerSideProps**       | ✅ 不使用   | App Router 完全移行       |
| **Reactライフサイクル旧API** | ✅ 不使用   | componentWillMount 等なし |
| **findDOMNode**              | ✅ 不使用   | ref を使用                |
| **moment/dayjs**             | ✅ 不使用   | date-fns に統一           |

### pages/ ディレクトリ

```
src/pages/api/trpc/[trpc].ts  ← tRPC用（App Router互換、問題なし）
```

### enum 使用（許容）

2ファイルのみ、正当な用途で使用:

- `src/lib/audit/logger.ts` - AuditEventType, AuditSeverity
- `src/lib/auth/session-config.ts` - SessionStatus

---

## 3. コードの一貫性 (8/10)

### エクスポートパターン

| パターン                  | 使用数 | 評価            |
| ------------------------- | ------ | --------------- |
| `export function`         | 313    | ✅ 主流         |
| `export const =`          | 139    | ✅ 許容         |
| `export default function` | 34     | ✅ App Router用 |

**評価**: `export function` が主流で一貫性あり。

### Props型定義

| パターン          | 使用数 | 評価    |
| ----------------- | ------ | ------- |
| `interface Props` | 265    | ✅ 主流 |
| `type Props =`    | 13     | ✅ 許容 |

**評価**: `interface` が主流で一貫性あり。

### スタイリング

| 項目               | 状態      | 詳細                     |
| ------------------ | --------- | ------------------------ |
| **直接カラー指定** | ✅ 不使用 | text-blue-500 等なし     |
| **セマンティック** | ✅ 使用   | bg-card, text-foreground |

### 改善候補

| 項目           | 現状                     | 推奨             |
| -------------- | ------------------------ | ---------------- |
| hooks命名      | 混在（`useX` / `use-x`） | `useX.ts` に統一 |
| インポートパス | 混在（`@/` / 相対）      | `@/` に統一      |

#### hooks命名の内訳

```
useCalendarSomething.ts  → 100+ ファイル（多数派）
use-calendar-something.ts → 13 ファイル
```

---

## 4. ドキュメント (9/10)

### 実装済み

| 対策              | 状態    | 詳細                   |
| ----------------- | ------- | ---------------------- |
| **CLAUDE.md**     | ✅ 整備 | プロジェクトルール     |
| **src/CLAUDE.md** | ✅ 整備 | コーディング規約       |
| **README各所**    | ✅ 整備 | 主要ディレクトリに配置 |
| **JSDoc**         | ✅ 一部 | 重要関数に記載         |

### ドキュメント検証

```bash
npm run docs:check      # コード整合性チェック
npm run docs:validate   # リンク・ルール検証
```

---

## 5. 型安全性 (9/10)

### 実装済み

| 対策             | 状態        | 詳細                 |
| ---------------- | ----------- | -------------------- |
| **strict mode**  | ✅ 有効     | tsconfig.json        |
| **any禁止**      | ✅ ルール化 | CLAUDE.md で禁止     |
| **Zod連携**      | ✅ 実装済み | tRPC全エンドポイント |
| **型生成**       | ✅ 自動化   | Supabase型生成       |
| **CI型チェック** | ✅ 必須     | マージ前必須         |

### 型チェックコマンド

```bash
npm run typecheck  # TypeScript型チェック
```

---

## 比喩で理解する保守性

### 🏠 「家の整理整頓」に例えると

| 対策               | 家で言うと                           |
| ------------------ | ------------------------------------ |
| **依存関係管理**   | 定期的な大掃除（不要なものを捨てる） |
| **非推奨API対応**  | 古い家電の買い替え（壊れる前に更新） |
| **コードの一貫性** | 収納ルール（同じものは同じ場所に）   |
| **ドキュメント**   | 取扱説明書（使い方がわかる）         |
| **型安全性**       | ラベル付け（何が入っているか明確）   |

### 現状のレベル

```
✅ 定期的に大掃除している（Dependabot）
✅ 古い家電がない（非推奨API不使用）
✅ 収納ルールがほぼ統一（エクスポート/型定義）
⚠️ 一部ラベルが違う（hooks命名の混在）
✅ 取扱説明書がある（CLAUDE.md）
```

**つまり**: 「整理整頓されていて、どこに何があるかわかる家」

---

## 改善優先度

### 高優先度（推奨）

- [ ] hooks命名を `useX.ts` に統一（13ファイル）
- [ ] knip設定追加（未使用依存検出）

### 中優先度（余裕があれば）

- [ ] インポートパスを `@/` に統一
- [ ] 一部の `export const =` を `export function` に統一

### 低優先度（必須ではない）

- [ ] JSDocカバレッジ向上

---

## 運用チェックリスト

### 週次（自動）

- [x] Dependabot PR確認
- [x] npm audit 実行

### 月次

- [ ] `npm outdated` で古いパッケージ確認
- [ ] Major更新の計画

### コードレビュー時

- [ ] CLAUDE.mdルール遵守確認
- [ ] 型エラーなし確認
- [ ] 一貫性チェック

---

## 関連ドキュメント

| ドキュメント                                   | 内容               |
| ---------------------------------------------- | ------------------ |
| [CLAUDE.md](/CLAUDE.md)                        | プロジェクトルール |
| [src/CLAUDE.md](/src/CLAUDE.md)                | コーディング規約   |
| [SECURITY_STATUS.md](SECURITY_STATUS.md)       | セキュリティ現状   |
| [RELIABILITY_STATUS.md](RELIABILITY_STATUS.md) | 信頼性現状         |

---

## 改訂履歴

| 日付       | バージョン | 変更内容 |
| ---------- | ---------- | -------- |
| 2025-12-26 | v1.0       | 初版作成 |
