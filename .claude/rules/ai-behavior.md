# AI行動規範

## 拡張思考（Extended Thinking）

| キーワード     | 思考予算       | 使用ケース                             |
| -------------- | -------------- | -------------------------------------- |
| `think`        | 低（5-10秒）   | 既存パターンの確認、簡単なバグ原因特定 |
| `think hard`   | 中（30-60秒）  | 複雑なロジック設計、複数選択肢の比較   |
| `think harder` | 高（2-3分）    | アーキテクチャ変更、複数機能の統合設計 |
| `ultrathink`   | 最大（5-10分） | CLAUDE.md変更、プロジェクト全体の方針  |

## 曖昧な指示への対応

推測で実装せず、確認を求める。確信度99%未満 → 必ず確認。

### 判断基準

以下が不明なら「曖昧」と判断:

- 目的（何を変えるか / 変えないか）
- 完了条件（受け入れ基準、エッジケース）
- スコープ（対象ファイル/コンポーネント）
- 制約（互換性、パフォーマンス、依存関係）
- 安全性/可逆性（データ移行、ロールバック）

### 質問ルール

- **1-5問** に絞る（全分岐を排除する質問を優先）
- 選択肢を提示し `defaults` で一括承認できる形式にする
- 低リスクな探索読み取りで答えが分かるなら質問しない

```
1) スコープ?
a) 最小変更（default）
b) 周辺もリファクタ
c) Not sure - use default
2) 互換性?
a) プロジェクト現行設定（default）
b) 旧バージョンも対応

Reply: defaults (or 1a 2b)
```

### アンチパターン

- 設定ファイルやコードを読めば分かることを質問しない
- 自由回答より選択式を使う
- 実装開始後に基本仕様を質問しない

## Subagentモデル選択

Taskツールでsubagentを起動する際のモデル選択基準:

| モデル     | コスト      | 使うべきタスク                                                              |
| ---------- | ----------- | --------------------------------------------------------------------------- |
| **Haiku**  | $0.25/$1.25 | ファイル検索、Grep、ドキュメント調査、単体テスト生成                        |
| **Sonnet** | $3/$15      | 通常のコード実装、バグ修正、パターンマッチ型スキャン（security-auditor等）  |
| **Opus**   | $15/$75     | 5+ファイル変更、アーキテクチャ設計、セキュリティレビュー（red/blue team等） |

**原則**: Sonnetをデフォルトに、必要時のみOpusにアップグレード。並列Haiku > 単発Opusを検討。

## ルール競合時の優先順位

1. CLAUDE.md + `.claude/rules/` のルール（最優先）
2. ユーザーの指示（ルールと矛盾する場合は透過的に確認）
3. ユーザーが同意した例外 → 理由をコミットメッセージに記録

## 開発者への説明スタイル

開発者は学びながら開発している:

- 「何をするか」と「**なぜそうするか**」をセットで説明
- GAFAのベストプラクティスに基づいた判断を明示
- ツール間の関係性（Next.js, Supabase, tRPC, Zustand）を意識
- 技術的負債を見つけたら積極的に解消を提案

## 意思決定の優先順位（GAFA-First）

1. GAFA製/推奨のものがあるか → あれば使う
2. 既存スタックで解決できるか → shadcn/ui, Zustand, tRPC
3. どれもなければ → 最もシンプルな方法

### 参照順

1. 公式ドキュメント（Next.js, React, TypeScript, Tailwind CSS）
2. プロジェクトルール（CLAUDE.md, `.claude/rules/`, `.claude/skills/`）
3. 既存実装パターン（同一ディレクトリ内のコード）

## ドキュメント提案

機能実装の完了後、`.claude/skills/docs-writing/SUGGEST.md` を参照してドキュメント更新を提案する。

## 学習パターン

`.claude/sessions/learned/` に蓄積されたプロジェクト固有の解決パターンを活用する。

- エラーに遭遇 → まず `ls .claude/sessions/learned/` で関連パターンを確認
- 新しいパターンを発見 → ユーザーに確認後、以下の形式で保存
- 自動チェック: `zustand-*.md`, `trpc-*.md`, `calendar-*.md`, `typescript-*.md`

### 保存基準

- **保存する**: Dayopt固有の知見、公式ドキュメントにないワークアラウンド、2回以上ハマった問題
- **保存しない**: 一般的すぎるパターン、一時的な対処

### ファイル形式

ファイル名: `{category}-{topic}.md`（例: `zustand-optimistic-update-undefined-cache.md`）

```markdown
# [パターン名]

## Problem

[どんな問題が発生したか]

## Solution

[どう解決したか - コード例含む]

## Why It Works

[なぜこのアプローチが有効か]

## When to Use

[どんな状況で使うべきか]

## Related Files

[関連するファイルパス]
```
