@import 'tailwindcss';

/* Tailwind Plugins */
@plugin '@tailwindcss/typography';

/* Tailwind v4 ダークモード設定 */
@variant dark (.dark &);

/* ============================================
 * カラーシステム（modern-minimal OKLCH）
 * ハイブリッド構造: :root + .dark + @theme inline
 * shadcn/ui互換 + Tailwind v4準拠
 * ============================================ */

/* ライトモード（CSS変数定義） */
:root {
  /* ============================================
   * Surface体系（GAFA準拠・4段階）
   * Material Design 3 / Apple HIG の共通原則に基づく意味ベース設計
   *
   * Background: ページ背景（最明）
   * Card: カード、ダイアログ
   * Container: サイドバー、セクション
   * Overlay: ポップオーバー（background直下の明度）
   *
   * 明度順（ライト）: background > overlay > container > card
   * 各段階で約3%の明度差（GAFA準拠）
   * ============================================ */
  --background: oklch(0.99 0 0);                  /* ページ背景 */
  --foreground: oklch(0.25 0 0);

  /* Surface（意味ベース4段階・GAFA準拠の明度差） */
  --overlay: oklch(0.96 0 0);                     /* ポップオーバー（差: 0.03） */
  --container: oklch(0.93 0 0);                   /* サイドバー、セクション（差: 0.03） */
  --card: oklch(0.90 0 0);                        /* カード、ダイアログ（差: 0.03） */

  /* Calendar Boxes（カレンダー専用Surface） */
  --plan-box: oklch(0.88 0 0);                    /* vs background(0.99): より強調 */
  --record-box: oklch(0.92 0.08 55);              /* Record用: 暖色オレンジ系 */
  --record-border: oklch(0.65 0.15 55);           /* Record左ボーダー: オレンジ系 */

  /* 互換性エイリアス（shadcn/ui用） */
  --card-foreground: oklch(0.25 0 0);
  --popover: var(--overlay);
  --popover-foreground: oklch(0.25 0 0);
  --secondary: var(--container);
  --secondary-foreground: oklch(0.25 0 0);
  --muted-foreground: oklch(0.35 0.02 264.54);

  /* Primary */
  --primary: oklch(0.45 0.188 259.8145);
  --primary-foreground: oklch(1 0 0);

  /* State: Active（選択中・アクティブ状態） */
  --state-active: oklch(0.9514 0.025 236.8242);
  --state-active-foreground: oklch(0.3791 0.1378 265.5222);

  /* shadcn/ui互換エイリアス（accent → state-active） */
  --accent: var(--state-active);
  --accent-foreground: var(--state-active-foreground);

  /* Semantic Colors */
  --destructive: oklch(0.6368 0.2078 25.3313);
  --destructive-foreground: oklch(1 0 0);
  --warning: oklch(0.7039 0.1555 68.04);
  --warning-foreground: oklch(1 0 0);
  --success: oklch(0.5859 0.1684 149.2);
  --success-foreground: oklch(1 0 0);
  --info: oklch(0.42 0 0);
  --info-foreground: oklch(1 0 0);

  /* Chronotype Colors（生産性ゾーン） */
  --chronotype-peak: oklch(0.72 0.19 145);        /* ピーク - 緑 */
  --chronotype-good: oklch(0.85 0.12 145);        /* 集中 - 薄緑 */
  --chronotype-moderate: oklch(0.85 0.08 250);    /* 通常 - 青 */
  --chronotype-low: oklch(0.92 0.01 250);         /* 低調 - グレー */
  --chronotype-sleep: oklch(0.65 0.20 310);       /* 睡眠 - 紫 */

  /* Borders & Inputs */
  --border: oklch(0.75 0.01 264.54);
  --input: var(--overlay);
  --ring: oklch(0.6231 0.188 259.8145);

  /* Charts - Comparison（比較用、shadcn準拠） */
  --chart-1: oklch(0.6231 0.188 259.8145);
  --chart-2: oklch(0.5461 0.2152 262.8809);
  --chart-3: oklch(0.4882 0.2172 264.3763);
  --chart-4: oklch(0.4244 0.1809 265.6377);
  --chart-5: oklch(0.3791 0.1378 265.5222);
}

/* ダークモード（CSS変数上書き） */
.dark {
  /* ============================================
   * Surface体系（GAFA準拠・4段階）
   * MD3原則: 高いelevationほど明るい
   * 各段階で約5〜6%の明度差（GAFA準拠）
   *
   * 明度順（ダーク）: overlay > background > container > card
   * ============================================ */
  --background: oklch(0.24 0 0);                  /* ページ背景 */
  --foreground: oklch(0.9219 0 0);

  /* Surface（意味ベース4段階・GAFA準拠の明度差） */
  --overlay: oklch(0.30 0 0);                     /* ポップオーバー（差: 0.06） */
  --container: oklch(0.18 0 0);                   /* サイドバー、セクション（差: 0.06） */
  --card: oklch(0.12 0 0);                        /* カード、ダイアログ（差: 0.06） */

  /* Calendar Boxes（カレンダー専用Surface） */
  --plan-box: oklch(0.16 0 0);                    /* vs background(0.24): より強調 */
  --record-box: oklch(0.22 0.05 55);              /* Record用: 暖色オレンジ系 */
  --record-border: oklch(0.55 0.12 55);           /* Record左ボーダー: オレンジ系 */

  /* 互換性エイリアス（shadcn/ui用） */
  --card-foreground: oklch(0.9219 0 0);
  --popover: var(--overlay);
  --popover-foreground: oklch(0.9219 0 0);
  --secondary: var(--container);
  --secondary-foreground: oklch(0.95 0 0);
  --muted-foreground: oklch(0.78 0 0);

  /* Primary */
  --primary: oklch(0.5 0.188 259.8145);
  --primary-foreground: oklch(1 0 0);

  /* State: Active（選択中・アクティブ状態） */
  --state-active: oklch(0.3791 0.1378 265.5222);
  --state-active-foreground: oklch(0.8823 0.0571 254.1284);

  /* shadcn/ui互換エイリアス（accent → state-active） */
  --accent: var(--state-active);
  --accent-foreground: var(--state-active-foreground);

  /* Semantic Colors */
  --destructive: oklch(0.6368 0.2078 25.3313);
  --destructive-foreground: oklch(1 0 0);
  --warning: oklch(0.7039 0.1555 68.04);
  --warning-foreground: oklch(1 0 0);
  --success: oklch(0.5859 0.1684 149.2);
  --success-foreground: oklch(1 0 0);
  --info: oklch(0.42 0 0);
  --info-foreground: oklch(1 0 0);

  /* Chronotype Colors（生産性ゾーン - ダークモード用） */
  --chronotype-peak: oklch(0.65 0.17 145);        /* ピーク - 緑（やや暗め） */
  --chronotype-good: oklch(0.55 0.14 145);        /* 集中 - 緑（暗め） */
  --chronotype-moderate: oklch(0.50 0.10 250);    /* 通常 - 青（暗め） */
  --chronotype-low: oklch(0.45 0.02 250);         /* 低調 - グレー（暗め） */
  --chronotype-sleep: oklch(0.50 0.18 310);       /* 睡眠 - 紫（暗め） */

  /* Borders & Inputs */
  --border: oklch(0.3715 0 0);
  --input: var(--overlay);
  --ring: oklch(0.6231 0.188 259.8145);

  /* Charts - Comparison（比較用、shadcn準拠） */
  --chart-1: oklch(0.7137 0.1434 254.624);
  --chart-2: oklch(0.6231 0.188 259.8145);
  --chart-3: oklch(0.5461 0.2152 262.8809);
  --chart-4: oklch(0.4882 0.2172 264.3763);
  --chart-5: oklch(0.4244 0.1809 265.6377);
}

/* Tailwindへのマッピング（@theme inline） */
@theme inline {
  /* ============================================
   * ステートレイヤー（M3準拠）
   * foregroundベースの半透明オーバーレイ
   * 一箇所変更で全体に反映
   * ============================================ */
  --color-state-hover: oklch(from var(--foreground) l c h / 10%);
  --color-state-focus: oklch(from var(--foreground) l c h / 12%);
  --color-state-pressed: oklch(from var(--foreground) l c h / 12%);
  --color-state-selected: oklch(from var(--foreground) l c h / 12%);
  --color-state-dragged: oklch(from var(--foreground) l c h / 16%);
  --color-state-active: var(--state-active);
  --color-state-active-foreground: var(--state-active-foreground);

  /* 塗りボタン用ホバー（背景色を暗くする方式） */
  --color-primary-hover: oklch(from var(--primary) l c h / 90%);
  --color-destructive-hover: oklch(from var(--destructive) l c h / 90%);
  --color-warning-hover: oklch(from var(--warning) l c h / 90%);
  --color-success-hover: oklch(from var(--success) l c h / 90%);
  --color-info-hover: oklch(from var(--info) l c h / 90%);

  /* ============================================
   * Primaryベースのステートレイヤー
   * 「新規追加」ボタン等、primary強調したい要素用
   * ============================================ */
  --color-primary-state-hover: oklch(from var(--primary) l c h / 10%);
  --color-primary-state-selected: oklch(from var(--primary) l c h / 12%);

  /* ============================================
   * Container トークン（M3準拠）
   * バッジ、アイコン背景、今日ハイライト等の装飾的背景
   * bg-primary/10, /12 を統一
   * ============================================ */
  --color-primary-container: oklch(from var(--primary) l c h / 12%);
  --color-on-primary-container: var(--primary);
  --color-success-container: oklch(from var(--success) l c h / 12%);
  --color-on-success-container: var(--success);

  /* Destructive ステートレイヤー */
  --color-destructive-container: oklch(from var(--destructive) l c h / 12%);
  --color-on-destructive-container: var(--destructive);
  --color-destructive-state-hover: oklch(from var(--destructive) l c h / 10%);

  /* Accent（睡眠セクション用） */
  --color-accent-container: oklch(from var(--accent) l c h / 10%);
  --color-accent-state-selected: oklch(from var(--accent) l c h / 20%);

  /* Secondary ホバー */
  --color-secondary-hover: oklch(from var(--secondary) l c h / 80%);

  /* ============================================
   * Surface トークン（GAFA準拠・4段階）
   * background: ページ背景
   * card: カード、ダイアログ
   * container: サイドバー、セクション
   * overlay: ポップオーバー
   * ============================================ */
  --color-background: var(--background);
  --color-foreground: var(--foreground);
  --color-card: var(--card);
  --color-card-foreground: var(--card-foreground);
  --color-container: var(--container);
  --color-overlay: var(--overlay);
  --color-plan-box: var(--plan-box);
  --color-record-box: var(--record-box);
  --color-record-border: var(--record-border);
  --color-popover: var(--popover);
  --color-popover-foreground: var(--popover-foreground);
  --color-primary: var(--primary);
  --color-primary-foreground: var(--primary-foreground);
  --color-secondary: var(--secondary);
  --color-secondary-foreground: var(--secondary-foreground);
  --color-muted: var(--container);
  --color-muted-foreground: var(--muted-foreground);

  /* 後方互換エイリアス（shadcn/ui互換） */
  --color-surface-container: var(--container);
  --color-accent: var(--accent);
  --color-accent-foreground: var(--accent-foreground);
  --color-destructive: var(--destructive);
  --color-destructive-foreground: var(--destructive-foreground);
  --color-warning: var(--warning);
  --color-warning-foreground: var(--warning-foreground);
  --color-success: var(--success);
  --color-success-foreground: var(--success-foreground);
  --color-info: var(--info);
  --color-info-foreground: var(--info-foreground);
  --color-border: var(--border);
  --color-input: var(--input);
  --color-ring: var(--ring);
  /* Charts - Comparison（比較用） */
  --color-chart-1: var(--chart-1);
  --color-chart-2: var(--chart-2);
  --color-chart-3: var(--chart-3);
  --color-chart-4: var(--chart-4);
  --color-chart-5: var(--chart-5);

  /* Charts - Semantic（意味ベース、既存セマンティックカラー参照） */
  --color-chart-primary: var(--primary);
  --color-chart-success: var(--success);
  --color-chart-warning: var(--warning);
  --color-chart-destructive: var(--destructive);
  --color-chart-info: var(--info);
  --color-chart-muted: var(--muted-foreground);

  /* ============================================
   * Backdrop トークン（モーダル背景、バックドロップ）
   * bg-black/80 等のハードコードを置き換え
   * ============================================ */
  --color-backdrop: oklch(0 0 0 / 50%);
  --color-backdrop-heavy: oklch(0 0 0 / 80%);
  /* 後方互換エイリアス */
  --color-overlay-heavy: var(--color-backdrop-heavy);

  /* ============================================
   * Shadow トークン（ドラッグ、ホバー時のシャドウ）
   * rgba(0,0,0,...) のハードコードを置き換え
   * ============================================ */
  --shadow-color: oklch(0 0 0 / 15%);
  --shadow-color-heavy: oklch(0 0 0 / 20%);
}

@theme {
  /* ============================================
   * スペーシング（8pxグリッド）
   * ============================================ */
  --spacing-xs: 0.5rem; /* 8px */
  --spacing-sm: 1rem; /* 16px */
  --spacing-md: 1.5rem; /* 24px */
  --spacing-lg: 2rem; /* 32px */
  --spacing-xl: 3rem; /* 48px */
  --spacing-2xl: 4rem; /* 64px */

  /* ============================================
   * スクロールバー（8pxグリッド準拠）
   * ============================================ */
  --scrollbar-width: 1rem; /* 16px - スクロールバー全体の幅 */
  --scrollbar-padding: 0.25rem; /* 4px - thumbの周りの余白 */

  /* ============================================
   * ボーダー半径（8pxグリッド準拠）
   * ============================================ */
  --radius-sm: 0.25rem; /* 4px - 例外: 小要素用 */
  --radius-md: 0.5rem; /* 8px */
  --radius-xl: 1rem; /* 16px */
  --radius-2xl: 1.5rem; /* 24px */
  --radius-full: 9999px;

  /* ============================================
   * シャドウ（modern-minimal準拠）
   * ============================================ */
  --shadow-xs: 0 1px 3px 0px hsl(0 0% 0% / 0.05);
  --shadow-sm: 0 1px 3px 0px hsl(0 0% 0% / 0.1), 0 1px 2px -1px hsl(0 0% 0% / 0.1);
  --shadow: 0 1px 3px 0px hsl(0 0% 0% / 0.1), 0 1px 2px -1px hsl(0 0% 0% / 0.1);
  --shadow-md: 0 1px 3px 0px hsl(0 0% 0% / 0.1), 0 2px 4px -1px hsl(0 0% 0% / 0.1);
  --shadow-lg: 0 1px 3px 0px hsl(0 0% 0% / 0.1), 0 4px 6px -1px hsl(0 0% 0% / 0.1);
  --shadow-xl: 0 1px 3px 0px hsl(0 0% 0% / 0.1), 0 8px 10px -1px hsl(0 0% 0% / 0.1);
  --shadow-2xl: 0 1px 3px 0px hsl(0 0% 0% / 0.25);

  /* ============================================
   * Z-Index
   * ============================================ */
  --z-dropdown: 1000;
  --z-sticky: 1020;
  --z-fixed: 1030;
  --z-modal-backdrop: 1040;
  --z-modal: 1050;
  --z-popover: 1060;
  --z-tooltip: 1070;

  /* ============================================
   * タイポグラフィトークン
   * ============================================ */

  /* フォントサイズ（8pxグリッド準拠） */
  --font-size-xs: 0.75rem; /* 12px - 例外: 最小サイズ */
  --font-size-sm: 0.875rem; /* 14px - 例外: 視認性確保 */
  --font-size-base: 1rem; /* 16px */
  --font-size-lg: 1.5rem; /* 24px */
  --font-size-xl: 2rem; /* 32px */
  --font-size-2xl: 2.5rem; /* 40px */
  --font-size-3xl: 3rem; /* 48px */
  --font-size-4xl: 4rem; /* 64px */

  /* 見出し用（8pxグリッド準拠） */
  --font-size-heading-h1: 3rem; /* 48px */
  --font-size-heading-h2: 2rem; /* 32px */
  --font-size-heading-h3: 1.5rem; /* 24px */
  --font-size-heading-h4: 1.25rem; /* 20px - 例外: 視覚的バランス用 */

  /* 行間 */
  --line-height-tight: 1.2;
  --line-height-normal: 1.5;
  --line-height-relaxed: 1.75;

  /* フォントウェイト
   * Tailwindデフォルトを使用（CSS変数不要）
   * - font-normal: 400（本文）
   * - font-bold: 700（見出し、強調）
   * ダークモードで切り替える必要がないため、トークン化しない
   */
}

/* next/font 最適化フォント適用（GAFA方針準拠フォールバックスタック） */
body {
  font-family:
    var(--font-inter),
    var(--font-noto-jp),
    -apple-system,
    BlinkMacSystemFont,
    'Segoe UI',
    Roboto,
    'Helvetica Neue',
    Arial,
    'Hiragino Sans',
    'Hiragino Kaku Gothic ProN',
    Meiryo,
    sans-serif;
  font-feature-settings: 'cv11', 'ss01';
  font-variation-settings: 'opsz' 32;
}

/* ブラウザUI・タッチ最適化 */
html {
  color-scheme: light;
  /* タップハイライト無効化（独自フィードバック使用） */
  -webkit-tap-highlight-color: transparent;
  -webkit-touch-callout: none;
  -webkit-overflow-scrolling: touch;
}

html.dark {
  color-scheme: dark;
}

/* ============================================
 * スクロールバーのスタイリング
 * ============================================ */
/* Webkit系ブラウザ（Chrome, Safari, Edge） */
::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

::-webkit-scrollbar-track {
  background: transparent;
}

::-webkit-scrollbar-thumb {
  background: color-mix(in oklch, var(--color-muted-foreground) 30%, transparent);
  border-radius: 8px;
}

/* Firefox */
* {
  scrollbar-width: thin;
  scrollbar-color: color-mix(in oklch, var(--color-muted-foreground) 30%, transparent) transparent;
}

/* ============================================
 * カスタムユーティリティクラス
 * ============================================ */
@layer utilities {
  /* タイポグラフィ - 見出し
   * letter-spacing: -0.025em は大きい文字の視覚的バランス改善用
   * Interはtext typeフォントのため、大きいサイズでは文字間隔が広く見える
   */
  .text-heading-h1 {
    font-size: var(--font-size-heading-h1);
    font-weight: 700;
    line-height: var(--line-height-tight);
    letter-spacing: -0.025em;
  }

  .text-heading-h2 {
    font-size: var(--font-size-heading-h2);
    font-weight: 700;
    line-height: var(--line-height-tight);
    letter-spacing: -0.025em;
  }

  .text-heading-h3 {
    font-size: var(--font-size-heading-h3);
    font-weight: 700;
    line-height: var(--line-height-tight);
    letter-spacing: -0.025em;
  }

  .text-heading-h4 {
    font-size: var(--font-size-heading-h4);
    font-weight: 700;
    line-height: var(--line-height-normal);
    letter-spacing: -0.025em;
  }

  /* タイポグラフィ - 本文 */
  .text-body-base {
    font-size: var(--font-size-base);
    line-height: var(--line-height-normal);
  }

  .text-body-lg {
    font-size: var(--font-size-lg);
    line-height: var(--line-height-normal);
  }

  .text-body-sm {
    font-size: var(--font-size-sm);
    line-height: var(--line-height-normal);
  }

  .text-body-xs {
    font-size: var(--font-size-xs);
    line-height: var(--line-height-normal);
  }
}

/* ============================================
 * アニメーション（shadcn/ui 公式準拠）
 * ============================================ */
@layer utilities {
  /* Keyframes */
  @keyframes slideInFromRight {
    from {
      transform: translateX(100%);
    }
    to {
      transform: translateX(0);
    }
  }

  @keyframes slideOutToRight {
    from {
      transform: translateX(0);
    }
    to {
      transform: translateX(100%);
    }
  }

  @keyframes slideInFromBottom {
    from {
      transform: translateY(100%);
    }
    to {
      transform: translateY(0);
    }
  }

  @keyframes slideOutToBottom {
    from {
      transform: translateY(0);
    }
    to {
      transform: translateY(100%);
    }
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }

  @keyframes fadeOut {
    from {
      opacity: 1;
    }
    to {
      opacity: 0;
    }
  }

  @keyframes zoomIn {
    from {
      opacity: 0;
      transform: scale(0.95);
    }
    to {
      opacity: 1;
      transform: scale(1);
    }
  }

  @keyframes zoomOut {
    from {
      opacity: 1;
      transform: scale(1);
    }
    to {
      opacity: 0;
      transform: scale(0.95);
    }
  }

  @keyframes slideInFromTop {
    from {
      transform: translateY(-2px);
    }
    to {
      transform: translateY(0);
    }
  }

  @keyframes slideInFromLeft {
    from {
      transform: translateX(-2px);
    }
    to {
      transform: translateX(0);
    }
  }

  /* Shake animation for error feedback (Apple HIG style) */
  @keyframes shake {
    0%, 100% {
      transform: translateX(0);
    }
    10%, 30%, 50%, 70%, 90% {
      transform: translateX(-4px);
    }
    20%, 40%, 60%, 80% {
      transform: translateX(4px);
    }
  }

  .animate-shake {
    animation: shake 0.4s ease-in-out;
  }

  /* Animation classes */
  .animate-in {
    animation-duration: 150ms;
    animation-fill-mode: both;
  }

  .animate-out {
    animation-duration: 150ms;
    animation-fill-mode: both;
  }

  .fade-in {
    animation-name: fadeIn;
  }

  .fade-out {
    animation-name: fadeOut;
  }

  .fade-in-0 {
    animation-name: fadeIn;
    animation-duration: 0ms;
  }

  .fade-out-0 {
    animation-name: fadeOut;
    animation-duration: 0ms;
  }

  .slide-in-from-right {
    animation-name: slideInFromRight;
    animation-timing-function: cubic-bezier(0.16, 1, 0.3, 1);
  }

  .slide-out-to-right {
    animation-name: slideOutToRight;
    animation-timing-function: cubic-bezier(0.16, 1, 0.3, 1);
  }

  .slide-in-from-bottom {
    animation-name: slideInFromBottom;
    animation-timing-function: cubic-bezier(0.16, 1, 0.3, 1);
  }

  .slide-out-to-bottom {
    animation-name: slideOutToBottom;
    animation-timing-function: cubic-bezier(0.16, 1, 0.3, 1);
  }

  .duration-300 {
    animation-duration: 300ms;
  }

  .duration-500 {
    animation-duration: 500ms;
  }

  .zoom-in-95 {
    animation-name: zoomIn;
  }

  .zoom-out-95 {
    animation-name: zoomOut;
  }

  .slide-in-from-top-2 {
    animation-name: slideInFromTop;
  }

  .slide-in-from-left-2 {
    animation-name: slideInFromLeft;
  }

  .slide-in-from-right-2 {
    animation-name: slideInFromRight;
  }

  .slide-in-from-bottom-2 {
    animation-name: slideInFromBottom;
  }

  /* ============================================
   * ローディングアニメーション（GAFA準拠）
   * shimmer: 左→右の波アニメーション（Facebook/LinkedIn方式）
   * pulse: フェードイン/アウト（フォールバック）
   * ============================================ */
  @keyframes shimmer {
    0% {
      background-position: -200% 0;
    }
    100% {
      background-position: 200% 0;
    }
  }

  /* Shimmerアニメーション - pulseより40%速く感じる */
  .animate-shimmer {
    background: linear-gradient(
      90deg,
      var(--container) 0%,
      var(--overlay) 50%,
      var(--container) 100%
    );
    background-size: 200% 100%;
    animation: shimmer 1.5s ease-in-out infinite;
  }

  /* ダークモード対応シマー */
  .dark .animate-shimmer {
    background: linear-gradient(
      90deg,
      var(--container) 0%,
      var(--card) 50%,
      var(--container) 100%
    );
    background-size: 200% 100%;
  }

  /* Indeterminate Progress Bar アニメーション */
  @keyframes indeterminate {
    0% {
      transform: translateX(-100%);
    }
    100% {
      transform: translateX(400%);
    }
  }

  .animate-indeterminate {
    animation: indeterminate 1.5s ease-in-out infinite;
  }

  /* data-state対応 */
  [data-state='closed'].animate-out {
    animation-name: fadeOut;
  }

  [data-state='open'].animate-in {
    animation-name: fadeIn;
  }

  /* カスタムスクロールバー */
  .scrollbar-thin::-webkit-scrollbar {
    width: 8px;
    height: 8px;
  }

  .scrollbar-thin::-webkit-scrollbar-track {
    background: transparent;
  }

  .scrollbar-thin::-webkit-scrollbar-thumb {
    background: color-mix(in oklch, var(--color-muted-foreground) 30%, transparent);
    border-radius: 9999px;
  }

  .scrollbar-thin:hover::-webkit-scrollbar-thumb {
    background: color-mix(in oklch, var(--color-muted-foreground) 50%, transparent);
  }

  /* Firefox */
  .scrollbar-thin {
    scrollbar-width: thin;
    scrollbar-color: color-mix(in oklch, var(--color-muted-foreground) 30%, transparent) transparent;
  }

  .scrollbar-thin:hover {
    scrollbar-color: color-mix(in oklch, var(--color-muted-foreground) 50%, transparent) transparent;
  }

  /* カレンダー用カスタムスクロールバー（16px幅、8pxグリッド準拠） */
  .calendar-scrollbar::-webkit-scrollbar {
    width: 16px !important; /* --scrollbar-width */
    height: 16px !important;
  }

  .calendar-scrollbar::-webkit-scrollbar-track {
    background: transparent !important;
  }

  .calendar-scrollbar::-webkit-scrollbar-thumb {
    /* background-clip: padding-box テクニック */
    /* 透明なボーダーでpadding効果を実現 */
    border: 4px solid transparent !important; /* --scrollbar-padding */
    background-clip: padding-box !important;
    border-radius: 9999px !important;
    background-color: color-mix(in oklch, var(--color-muted-foreground) 30%, transparent) !important;
  }

  .calendar-scrollbar:hover::-webkit-scrollbar-thumb {
    background-color: color-mix(in oklch, var(--color-muted-foreground) 50%, transparent) !important;
  }

  /* Firefox */
  .calendar-scrollbar {
    scrollbar-width: auto !important;
    scrollbar-color: color-mix(in oklch, var(--color-muted-foreground) 30%, transparent) transparent !important;
    scrollbar-gutter: stable; /* スクロールバー非表示時も余白を確保 */
  }

  .calendar-scrollbar:hover {
    scrollbar-color: color-mix(in oklch, var(--color-muted-foreground) 50%, transparent) transparent !important;
  }
}

/* ============================================
 * Markdownエディタースタイル（modern-minimal準拠）
 * ============================================ */
.markdown-editor-wrapper {
  /* エディターコンテナ */
  & .w-md-editor {
    border-radius: var(--radius-md);
    border: 1px solid var(--color-border);
    background: var(--color-background);
    box-shadow: var(--shadow-sm);
    overflow: hidden;
  }

  /* ツールバー */
  & .w-md-editor-toolbar {
    background: var(--color-muted);
    border-bottom: 1px solid var(--color-border);
    padding: var(--spacing-xs);
    border-radius: var(--radius-md) var(--radius-md) 0 0;
  }

  & .w-md-editor-toolbar button {
    color: var(--color-foreground);
    border-radius: var(--radius-sm);
    transition: all 0.15s ease;
  }

  & .w-md-editor-toolbar button:hover {
    background: var(--color-accent);
    color: var(--color-accent-foreground);
  }

  & .w-md-editor-toolbar button.active {
    background: var(--color-primary);
    color: var(--color-primary-foreground);
  }

  & .w-md-editor-toolbar li.divider {
    border-left: 1px solid var(--color-border);
    margin: 0 var(--spacing-xs);
  }

  /* エディターエリア */
  & .w-md-editor-content {
    background: var(--color-background);
  }

  & .w-md-editor-text-pre,
  & .w-md-editor-text-input {
    font-family: ui-monospace, SFMono-Regular, 'SF Mono', Menlo, Monaco, Consolas, monospace !important;
    font-size: var(--font-size-sm);
    line-height: var(--line-height-relaxed);
    color: var(--color-foreground);
  }

  & .w-md-editor-text-input::placeholder {
    color: var(--color-muted-foreground);
  }

  /* プレビューエリア */
  & .w-md-editor-preview {
    background: var(--color-background);
    padding: var(--spacing-sm);
  }

  & .wmde-markdown {
    font-size: var(--font-size-sm);
    line-height: var(--line-height-relaxed);
    color: var(--color-foreground);
  }

  /* マークダウン要素のスタイリング */
  & .wmde-markdown h1 {
    font-size: var(--font-size-heading-h3);
    font-weight: 700;
    margin-top: var(--spacing-lg);
    margin-bottom: var(--spacing-sm);
    color: var(--color-foreground);
    border-bottom: 2px solid var(--color-border);
    padding-bottom: var(--spacing-xs);
  }

  & .wmde-markdown h2 {
    font-size: var(--font-size-heading-h4);
    font-weight: 700;
    margin-top: var(--spacing-md);
    margin-bottom: var(--spacing-xs);
    color: var(--color-foreground);
  }

  & .wmde-markdown h3 {
    font-size: var(--font-size-lg);
    font-weight: 700;
    margin-top: var(--spacing-md);
    margin-bottom: var(--spacing-xs);
    color: var(--color-foreground);
  }

  & .wmde-markdown p {
    margin-bottom: var(--spacing-sm);
  }

  & .wmde-markdown a {
    color: var(--color-primary);
    text-decoration: underline;
    text-decoration-color: color-mix(in oklch, var(--color-primary) 30%, transparent);
    transition: all 0.15s ease;
  }

  & .wmde-markdown a:hover {
    color: var(--color-primary);
    text-decoration-color: var(--color-primary);
  }

  & .wmde-markdown code {
    background: var(--color-muted);
    padding: 0.125rem 0.375rem;
    border-radius: var(--radius-sm);
    font-size: 0.875em;
    color: var(--color-foreground);
    border: 1px solid var(--color-border);
  }

  & .wmde-markdown pre {
    background: var(--color-muted);
    padding: var(--spacing-sm);
    border-radius: var(--radius-md);
    overflow-x: auto;
    border: 1px solid var(--color-border);
    margin: var(--spacing-sm) 0;
  }

  & .wmde-markdown pre code {
    background: transparent;
    padding: 0;
    border: none;
  }

  & .wmde-markdown blockquote {
    border-left: 4px solid var(--color-primary);
    padding-left: var(--spacing-sm);
    margin: var(--spacing-sm) 0;
    color: var(--color-muted-foreground);
    background: var(--color-muted);
    padding: var(--spacing-sm);
    border-radius: 0 var(--radius-md) var(--radius-md) 0;
  }

  & .wmde-markdown ul,
  & .wmde-markdown ol {
    margin: var(--spacing-sm) 0;
    padding-left: var(--spacing-lg);
  }

  & .wmde-markdown li {
    margin: var(--spacing-xs) 0;
  }

  & .wmde-markdown table {
    border-collapse: collapse;
    width: 100%;
    margin: var(--spacing-sm) 0;
  }

  & .wmde-markdown th,
  & .wmde-markdown td {
    border: 1px solid var(--color-border);
    padding: var(--spacing-xs);
    text-align: left;
  }

  & .wmde-markdown th {
    background: var(--color-muted);
    font-weight: 700;
  }

  & .wmde-markdown hr {
    border: none;
    border-top: 2px solid var(--color-border);
    margin: var(--spacing-lg) 0;
  }

  /* ダークモード対応 */
  &:has(.dark) .w-md-editor,
  .dark & .w-md-editor {
    border-color: var(--color-border);
    background: var(--color-background);
  }

  &:has(.dark) .w-md-editor-toolbar,
  .dark & .w-md-editor-toolbar {
    background: var(--color-muted);
    border-bottom-color: var(--color-border);
  }
}

/* ============================================
 * 時刻input内部のWebKit要素のギャップ削除
 * ============================================ */
input[type='time']::-webkit-datetime-edit-fields-wrapper {
  gap: 0 !important;
}

input[type='time']::-webkit-datetime-edit-hour-field {
  margin-right: 0 !important;
}

input[type='time']::-webkit-datetime-edit-minute-field {
  margin-left: 0 !important;
}

/* ============================================
 * Novel / ProseMirror エディタースタイル
 * ============================================ */
.ProseMirror {
  outline: none;
  min-height: 1.5rem;
  line-height: 1.5rem;
}

/* プレースホルダー - カーソルがある空の行に表示 */
.ProseMirror p.is-empty::before,
.ProseMirror p.is-editor-empty::before {
  content: attr(data-placeholder);
  color: var(--color-muted-foreground);
  pointer-events: none;
  float: left;
  height: 0;
}

/* エディター全体が空の場合 */
.ProseMirror.is-editor-empty p:first-child::before {
  content: attr(data-placeholder);
  color: var(--color-muted-foreground);
  pointer-events: none;
  float: left;
  height: 0;
}

/* Novel EditorCommand スタイルオーバーライド */
[data-novel-editor-command] {
  background-color: var(--color-card) !important;
}

[data-novel-editor-command-list] {
  background-color: var(--color-card) !important;
}

[data-novel-editor-command-item] {
  background-color: transparent !important;
}

/* Novel EditorCommand スクロールバースタイル */
.novel-command-menu::-webkit-scrollbar-track {
  background: transparent !important;
}

.novel-command-menu {
  scrollbar-color: color-mix(in oklch, var(--color-muted-foreground) 30%, transparent) transparent !important;
}

/* Prose styling for Novel editor */
.ProseMirror.prose {
  max-width: 100%;
}

/* 段落の余白を最小化（コンパクト表示） */
.ProseMirror p {
  margin: 0;
  line-height: 1.5rem;
}

.ProseMirror p:not(:last-child) {
  margin-bottom: 0.5rem;
}

/* 見出し */
.ProseMirror h1 {
  font-size: var(--font-size-heading-h1);
  font-weight: 700;
  line-height: var(--line-height-tight);
  margin-top: 1rem;
  margin-bottom: 0.5rem;
}

.ProseMirror h2 {
  font-size: var(--font-size-heading-h2);
  font-weight: 700;
  line-height: var(--line-height-tight);
  margin-top: 0.75rem;
  margin-bottom: 0.5rem;
}

.ProseMirror h3 {
  font-size: var(--font-size-heading-h3);
  font-weight: 700;
  line-height: var(--line-height-normal);
  margin-top: 0.75rem;
  margin-bottom: 0.5rem;
}

/* 最初の要素の上マージンを削除 */
.ProseMirror > *:first-child {
  margin-top: 0;
}

/* リスト */
.ProseMirror ul,
.ProseMirror ol {
  padding-left: 1.5rem;
  margin: 0.5rem 0;
}

.ProseMirror li {
  margin: 0.25rem 0;
}

.ProseMirror li > p {
  margin: 0;
}

/* タスクリスト */
.ProseMirror ul[data-type='taskList'] {
  list-style: none;
  padding-left: 0;
}

.ProseMirror ul[data-type='taskList'] li {
  display: flex;
  align-items: flex-start;
  gap: 0.5rem;
}

.ProseMirror ul[data-type='taskList'] li > label {
  flex-shrink: 0;
  margin-top: 0.125rem;
}

.ProseMirror ul[data-type='taskList'] li > div {
  flex-grow: 1;
}

/* 引用 */
.ProseMirror blockquote {
  border-left: 4px solid var(--color-primary);
  padding-left: 1rem;
  margin: 0.5rem 0;
  color: var(--color-muted-foreground);
}

/* コードブロック */
.ProseMirror pre {
  background: var(--color-muted);
  border-radius: var(--radius-md);
  padding: 0.75rem 1rem;
  margin: 0.5rem 0;
  overflow-x: auto;
}

.ProseMirror pre code {
  background: transparent;
  padding: 0;
  font-size: 0.875rem;
  color: var(--color-foreground);
}

/* インラインコード */
.ProseMirror code {
  background: var(--color-muted);
  padding: 0.125rem 0.375rem;
  border-radius: var(--radius-sm);
  font-size: 0.875em;
  color: var(--color-foreground);
}

/* 水平線 */
.ProseMirror hr {
  border: none;
  border-top: 1px solid var(--color-border);
  margin: 1rem 0;
}

/* ============================================
 * Calendar Animations
 * ============================================ */

/* ビュー切り替えアニメーション */
@keyframes calendar-zoom-in {
  from {
    opacity: 0;
    transform: scale(0.95);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}

@keyframes calendar-zoom-out {
  from {
    opacity: 0;
    transform: scale(1.05);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}

@keyframes calendar-slide-in {
  from {
    opacity: 0;
    transform: translateX(20px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

.calendar-zoom-in {
  animation: calendar-zoom-in 0.2s ease-out forwards;
}

.calendar-zoom-out {
  animation: calendar-zoom-out 0.2s ease-out forwards;
}

.calendar-slide-in {
  animation: calendar-slide-in 0.2s ease-out forwards;
}

/* ============================================
 * Safe Area Insets（iOS対応）
 *
 * iPhone X以降のノッチ・Dynamic Island・ホームインジケーター対応
 *
 * @see https://developer.apple.com/design/human-interface-guidelines/
 * @see https://css-tricks.com/the-notch-and-css/
 *
 * 使用例:
 * - ボトムナビ: pb-safe
 * - ヘッダー: pt-safe
 * - 全方向: p-safe
 * ============================================ */

/* Safe Area Padding ユーティリティ */
.pt-safe {
  padding-top: env(safe-area-inset-top);
}

.pr-safe {
  padding-right: env(safe-area-inset-right);
}

.pb-safe {
  padding-bottom: env(safe-area-inset-bottom);
}

.pl-safe {
  padding-left: env(safe-area-inset-left);
}

.px-safe {
  padding-left: env(safe-area-inset-left);
  padding-right: env(safe-area-inset-right);
}

.py-safe {
  padding-top: env(safe-area-inset-top);
  padding-bottom: env(safe-area-inset-bottom);
}

.p-safe {
  padding-top: env(safe-area-inset-top);
  padding-right: env(safe-area-inset-right);
  padding-bottom: env(safe-area-inset-bottom);
  padding-left: env(safe-area-inset-left);
}

/* Safe Area Margin ユーティリティ */
.mb-safe {
  margin-bottom: env(safe-area-inset-bottom);
}

.mt-safe {
  margin-top: env(safe-area-inset-top);
}

/* Fixed Bottom要素用（ボトムナビ、FAB等） */
.bottom-safe {
  bottom: env(safe-area-inset-bottom);
}

/* ============================================
 * モバイルタッチUX最適化
 *
 * @see https://developer.chrome.com/blog/overscroll-behavior
 * @see https://developer.mozilla.org/en-US/docs/Web/CSS/-webkit-tap-highlight-color
 * @see https://css-tricks.com/16px-or-larger-text-prevents-ios-form-zoom/
 * ============================================ */

/* スクロールチェーン防止（モーダル、ドロワー等で使用） */
.overscroll-none {
  overscroll-behavior: none;
}

.overscroll-contain {
  overscroll-behavior: contain;
}

/* Pull-to-Refresh無効化（PWAアプリ向け） */
body {
  overscroll-behavior-y: contain;
}

/* タッチフィードバック（:active状態の最適化） */
@media (hover: none) and (pointer: coarse) {
  /* タッチデバイス向けのアクティブ状態フィードバック */
  button:active,
  a:active,
  [role='button']:active {
    opacity: 0.7;
    transition: opacity 0.1s ease-out;
  }
}

/* iOS Safari入力ズーム防止（16px未満でズームが発生） */
@supports (-webkit-touch-callout: none) {
  /* iOSデバイスのみ適用 */
  input,
  textarea,
  select {
    font-size: max(16px, 1em);
  }
}

/* インタラクティブ要素のテキスト選択防止 */
button,
[role='button'],
[role='tab'],
[role='menuitem'],
.no-select {
  -webkit-user-select: none;
  -moz-user-select: none;
  user-select: none;
}

/* ドラッグ可能要素の最適化 */
[draggable='true'] {
  -webkit-user-select: none;
  -moz-user-select: none;
  user-select: none;
  -webkit-touch-callout: none;
  touch-action: none;
}

/* ============================================
 * prefers-reduced-motion 対応
 *
 * アニメーション・トランジションを減らす設定の尊重
 * WCAG 2.1 Success Criterion 2.3.3 準拠
 *
 * @see https://developer.mozilla.org/en-US/docs/Web/CSS/@media/prefers-reduced-motion
 * @see https://www.w3.org/WAI/WCAG21/Understanding/animation-from-interactions.html
 * ============================================ */

/* スムーズスクロール（reduced-motionでない場合のみ） */
@media (prefers-reduced-motion: no-preference) {
  html {
    scroll-behavior: smooth;
  }
}

/* reduced-motion: アニメーション・トランジションを最小化 */
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    /* アニメーションを無効化（必要最小限の0.01sに短縮） */
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    /* トランジションを無効化 */
    transition-duration: 0.01ms !important;
    /* スクロールを即時に */
    scroll-behavior: auto !important;
  }

  /* Shimmerアニメーションを静的な背景に置換 */
  .animate-shimmer {
    animation: none !important;
    background: var(--container) !important;
  }

  /* カレンダーアニメーションを無効化 */
  .calendar-zoom-in,
  .calendar-zoom-out,
  .calendar-slide-in {
    animation: none !important;
    opacity: 1 !important;
    transform: none !important;
  }

  /* フェード・スライドアニメーションを無効化 */
  .animate-in,
  .animate-out,
  .fade-in,
  .fade-out,
  .zoom-in-95,
  .zoom-out-95 {
    animation: none !important;
    opacity: 1 !important;
  }
}

/* スクロールバーの非表示（モバイルUI最適化、オプショナル） */
.scrollbar-hide {
  -ms-overflow-style: none;
  scrollbar-width: none;
}

.scrollbar-hide::-webkit-scrollbar {
  display: none;
}

/* モバイルではスクロールバーを非表示（iOS/Android標準挙動に準拠） */
@media (hover: none) and (pointer: coarse) {
  * {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }

  *::-webkit-scrollbar {
    display: none;
  }

  /* .scrollbar-thin クラスも非表示（より高い詳細度で上書き） */
  .scrollbar-thin {
    -ms-overflow-style: none !important;
    scrollbar-width: none !important;
  }

  .scrollbar-thin::-webkit-scrollbar {
    display: none !important;
  }

  /* カレンダー用スクロールバーも非表示 */
  .calendar-scrollbar {
    -ms-overflow-style: none !important;
    scrollbar-width: none !important;
  }

  .calendar-scrollbar::-webkit-scrollbar {
    display: none !important;
  }
}

/* 画像のドラッグ防止（モバイル操作時の誤操作防止） */
img {
  -webkit-user-drag: none;
  user-drag: none;
}

/* touch-actionユーティリティ（横スクロール領域向け） */
.touch-pan-y {
  touch-action: pan-y;
}

.touch-pan-x {
  touch-action: pan-x;
}

.touch-pan-y-pinch {
  touch-action: pan-y pinch-zoom;
}

.touch-pan-x-pinch {
  touch-action: pan-x pinch-zoom;
}

/* ============================================
 * フォーカス表示の最適化
 *
 * タッチデバイスではタップ時のフォーカスリングを非表示にし、
 * キーボード操作時のみ表示することでUXを向上
 *
 * @see https://developer.mozilla.org/en-US/docs/Web/CSS/:focus-visible
 * ============================================ */

/* タッチデバイス向け: タップ時のフォーカスリング非表示 */
@media (hover: none) and (pointer: coarse) {
  /* フォーカスはあるがfocus-visibleではない場合（タップ操作） */
  button:focus:not(:focus-visible),
  a:focus:not(:focus-visible),
  [role='button']:focus:not(:focus-visible),
  [role='tab']:focus:not(:focus-visible),
  [role='menuitem']:focus:not(:focus-visible) {
    outline: none;
    box-shadow: none;
  }
}

/* ============================================
 * scroll-snapユーティリティ
 *
 * スナップスクロールを実現するためのユーティリティクラス
 *
 * @see https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Scroll_Snap
 * ============================================ */

/* スナップコンテナ */
.snap-y {
  scroll-snap-type: y mandatory;
}

.snap-y-proximity {
  scroll-snap-type: y proximity;
}

.snap-x {
  scroll-snap-type: x mandatory;
}

.snap-x-proximity {
  scroll-snap-type: x proximity;
}

/* スナップアイテム */
.snap-start {
  scroll-snap-align: start;
}

.snap-center {
  scroll-snap-align: center;
}

.snap-end {
  scroll-snap-align: end;
}

/* スナップ停止（各アイテムで必ず停止） */
.snap-stop {
  scroll-snap-stop: always;
}

/* ============================================
 * aspect-ratioユーティリティ
 *
 * レスポンシブな要素のアスペクト比を維持
 * 画像、動画、チャートカード等に使用
 *
 * @see https://developer.mozilla.org/en-US/docs/Web/CSS/aspect-ratio
 * ============================================ */

/* 一般的なアスペクト比 */
.aspect-square {
  aspect-ratio: 1 / 1;
}

.aspect-video {
  aspect-ratio: 16 / 9;
}

.aspect-photo {
  aspect-ratio: 4 / 3;
}

.aspect-portrait {
  aspect-ratio: 3 / 4;
}

.aspect-wide {
  aspect-ratio: 21 / 9;
}

/* チャートカード用（ダッシュボード向け） */
.aspect-chart {
  aspect-ratio: 16 / 10;
}

.aspect-chart-tall {
  aspect-ratio: 4 / 5;
}

/* カード用 */
.aspect-card {
  aspect-ratio: 3 / 2;
}

/* ============================================
 * timepicker-ui カスタムスタイル
 * セマンティックトークンを適用してデザインシステムに統合
 * ============================================ */
.timepicker-ui-wrapper-active {
  --pm-bg-color: var(--popover);
  --pm-s-line-color: var(--primary);
  --pm-bg-time-number-select: var(--primary);
  --pm-text-time-number-select: var(--primary-foreground);
  --pm-text-color: var(--foreground);
  --pm-clock-hand-color: var(--primary);
  --pm-clock-hand-circle-color: var(--primary);
  --pm-clock-face-bg: var(--card);
  --pm-clock-face-bg-secondary: color-mix(in oklch, var(--card) 80%, var(--foreground) 20%);
  --pm-button-text-color: var(--primary);
  --pm-keyboard-icon-color: var(--muted-foreground);
  --pm-backdrop-bg: oklch(0 0 0 / 0.5);
}

/* モーダルを最前面に表示 */
.timepicker-ui-wrapper-active {
  z-index: 9999 !important;
}

/* ダークモード対応 */
.dark .timepicker-ui-wrapper-active {
  --pm-bg-color: var(--popover);
  --pm-clock-face-bg: var(--card);
  --pm-clock-face-bg-secondary: color-mix(in oklch, var(--card) 70%, var(--foreground) 30%);
}

