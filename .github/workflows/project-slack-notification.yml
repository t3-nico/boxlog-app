name: Project Slack Notifications

on:
  project_v2_item:
    types: [created, edited, deleted, moved, converted, restored, archived, reordered]

jobs:
  notify-slack:
    runs-on: ubuntu-latest
    steps:
      - name: Get Project Info
        uses: actions/github-script@v7
        id: project-info
        with:
          script: |
            const { context } = require('@actions/github');
            const action = context.payload.action;
            const projectItem = context.payload.projects_v2_item;

            let emoji = 'ğŸ“Š';
            let actionText = action;

            switch(action) {
              case 'created': emoji = 'â•'; actionText = 'ã‚¢ã‚¤ãƒ†ãƒ è¿½åŠ '; break;
              case 'edited': emoji = 'âœï¸'; actionText = 'ã‚¢ã‚¤ãƒ†ãƒ ç·¨é›†'; break;
              case 'deleted': emoji = 'ğŸ—‘ï¸'; actionText = 'ã‚¢ã‚¤ãƒ†ãƒ å‰Šé™¤'; break;
              case 'moved': emoji = 'ğŸ”„'; actionText = 'ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å¤‰æ›´'; break;
              case 'converted': emoji = 'ğŸ”„'; actionText = 'å¤‰æ›'; break;
              case 'restored': emoji = 'â™»ï¸'; actionText = 'å¾©å…ƒ'; break;
              case 'archived': emoji = 'ğŸ“¦'; actionText = 'ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–'; break;
              case 'reordered': emoji = 'ğŸ”ƒ'; actionText = 'ä¸¦ã³æ›¿ãˆ'; break;
            }

            const message = `${emoji} BoxLog Development Hub: ${actionText}`;

            return {
              message,
              action,
              repo: context.repo.repo,
              projectUrl: "https://github.com/users/t3-nico/projects/4"
            };

      - name: Send Slack Notification
        uses: 8398a7/action-slack@v3
        with:
          status: custom
          custom_payload: |
            {
              "text": "BoxLog Development Hub Update",
              "blocks": [
                {
                  "type": "section",
                  "text": {
                    "type": "mrkdwn",
                    "text": "${{ fromJson(steps.project-info.outputs.result).message }}"
                  }
                },
                {
                  "type": "context",
                  "elements": [
                    {
                      "type": "mrkdwn",
                      "text": "Repository: `${{ fromJson(steps.project-info.outputs.result).repo }}`"
                    }
                  ]
                },
                {
                  "type": "actions",
                  "elements": [
                    {
                      "type": "button",
                      "text": {
                        "type": "plain_text",
                        "text": "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’è¦‹ã‚‹"
                      },
                      "url": "${{ fromJson(steps.project-info.outputs.result).projectUrl }}"
                    }
                  ]
                }
              ]
            }
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}