#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# commitlintを使用したConventional Commits形式チェック
npx --no-install commitlint --edit $1

# 追加の日本語チェック（既存要件の維持）
commit_msg=$(cat $1)
commit_header=$(echo "$commit_msg" | head -n 1)
subject=$(echo "$commit_header" | sed 's/^[a-z]*\(\([a-zA-Z0-9_-]*\)\)\?!*: //')

# 日本語文字（ひらがな、カタカナ、漢字）が含まれているかチェック
if ! echo "$subject" | grep -q '[ぁ-んァ-ヶ亜-熙]'; then
    echo "❌ コミットメッセージのsubjectは日本語で記述してください"
    echo "現在のsubject: $subject"
    echo ""
    echo "✅ 正しい例:"
    echo "feat: 新しい機能を追加"
    echo "fix: ログインボタンの不具合を修正"
    echo "docs: READMEファイルを更新"
    exit 1
fi

echo "✅ コミットメッセージのフォーマットと日本語チェック完了"